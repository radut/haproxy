
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>How Lua runs in HAProxy &#8212; haproxy-lua 1.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="#">haproxy-lua 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="how-lua-runs-in-haproxy">
<h1>How Lua runs in HAProxy<a class="headerlink" href="#how-lua-runs-in-haproxy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="haproxy-lua-running-contexts">
<h2>HAProxy Lua running contexts<a class="headerlink" href="#haproxy-lua-running-contexts" title="Permalink to this headline">¶</a></h2>
<p>The Lua code executed in HAProxy can be processed in 2 main modes. The first one
is the <strong>initialisation mode</strong>, and the second is the <strong>runtime mode</strong>.</p>
<ul class="simple">
<li>In the <strong>initialisation mode</strong>, we can perform DNS solves, but we cannot
perform socket I/O. In this initialisation mode, HAProxy still blocked during
the execution of the Lua program.</li>
<li>In the <strong>runtime mode</strong>, we cannot perform DNS solves, but we can use sockets.
The execution of the Lua code is multiplexed with the requests processing, so
the Lua code seems to be run in blocking, but it is not the case.</li>
</ul>
<p>The Lua code is loaded in one or more files. These files contains main code and
functions. Lua have 6 execution context.</p>
<ol class="arabic">
<li><p class="first">The Lua file <strong>body context</strong>. It is executed during the load of the Lua file
in the HAProxy <cite>[global]</cite> section with the directive <cite>lua-load</cite>. It is
executed in initialisation mode. This section is use for configuring Lua
bindings in HAProxy.</p>
</li>
<li><p class="first">The Lua <strong>init context</strong>. It is a Lua function executed just after the
HAProxy configuration parsing. The execution is in initialisation mode. In
this context the HAProxy environment are already initialized. It is useful to
check configuration, or initializing socket connections or tasks. These
functions are declared in the body context with the Lua function
<cite>core.register_init()</cite>. The prototype of the function is a simple function
without return value and without parameters, like this: <cite>function fcn()</cite>.</p>
</li>
<li><p class="first">The Lua <strong>task context</strong>. It is a Lua function executed after the start
of the HAProxy scheduler, and just after the declaration of the task with the
Lua function <cite>core.register_task()</cite>. This context can be concurrent with the
traffic processing. It is executed in runtime mode. The prototype of the
function is a simple function without return value and without parameters,
like this: <cite>function fcn()</cite>.</p>
</li>
<li><p class="first">The <strong>action context</strong>. It is a Lua function conditionally executed. These
actions are registered by the Lua directives “<cite>core.register_action()</cite>”. The
prototype of the Lua called function is a function with doesn’t returns
anything and that take an object of class TXN as entry. <cite>function fcn(txn)</cite>.</p>
</li>
<li><p class="first">The <strong>sample-fetch context</strong>. This function takes a TXN object as entry
argument and returns a string. These types of function cannot execute any
blocking function. They are useful to aggregate some of original HAProxy
sample-fetches and return the result. The prototype of the function is
<cite>function string fcn(txn)</cite>. These functions can be registered with the Lua
function <cite>core.register_fetches()</cite>. Each declared sample-fetch is prefixed by
the string “lua.”.</p>
<p><strong>NOTE</strong>: It is possible that this function cannot found the required data
in the original HAProxy sample-fetches, in this case, it cannot return the
result. This case is not yet supported</p>
</li>
<li><p class="first">The <strong>converter context</strong>. It is a Lua function that takes a string as input
and returns another string as output. These types of function are stateless,
it cannot access to any context. They don’t execute any blocking function.
The call prototype is <cite>function string fcn(string)</cite>. This function can be
registered with the Lua function <cite>core.register_converters()</cite>. Each declared
converter is prefixed by the string “lua.”.</p>
</li>
</ol>
</div>
<div class="section" id="haproxy-lua-hello-world">
<h2>HAProxy Lua Hello world<a class="headerlink" href="#haproxy-lua-hello-world" title="Permalink to this headline">¶</a></h2>
<p>HAProxy configuration file (<cite>hello_world.conf</cite>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">global</span>
   <span class="n">lua</span><span class="o">-</span><span class="n">load</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">lua</span>

<span class="n">listen</span> <span class="n">proxy</span>
   <span class="n">bind</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">10001</span>
   <span class="n">tcp</span><span class="o">-</span><span class="n">request</span> <span class="n">inspect</span><span class="o">-</span><span class="n">delay</span> <span class="mi">1</span><span class="n">s</span>
   <span class="n">tcp</span><span class="o">-</span><span class="n">request</span> <span class="n">content</span> <span class="n">use</span><span class="o">-</span><span class="n">service</span> <span class="n">lua</span><span class="o">.</span><span class="n">hello_world</span>
</pre></div>
</div>
<p>HAProxy Lua file (<cite>hello_world.lua</cite>):</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">core</span><span class="p">.</span><span class="n">register_service</span><span class="p">(</span><span class="s2">&quot;hello_world&quot;</span><span class="p">,</span> <span class="s2">&quot;tcp&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">applet</span><span class="p">)</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;hello world</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<p>How to start HAProxy for testing this configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">haproxy</span> <span class="o">-</span><span class="n">f</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>On other terminal, you can test with telnet:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#:~ telnet 127.0.0.1 10001</span>
<span class="n">hello</span> <span class="n">world</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="core-class">
<h1>Core class<a class="headerlink" href="#core-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="core">
<em class="property">class </em><code class="descname">core</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#core" title="Permalink to this definition">¶</a></dt>
<dd><p>The “core” class contains all the HAProxy core functions. These function are
useful for the controlling the execution flow, registering hooks, manipulating
global maps or ACL, …</p>
<p>“core” class is basically provided with HAProxy. No <cite>require</cite> line is
required to uses these function.</p>
<p>The “core” class is static, it is not possible to create a new object of this
type.</p>
</dd></dl>

<dl class="attribute">
<dt id="core.emerg">
<code class="descclassname">core.</code><code class="descname">emerg</code><a class="headerlink" href="#core.emerg" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “emergency” (0).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.alert">
<code class="descclassname">core.</code><code class="descname">alert</code><a class="headerlink" href="#core.alert" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “alert” (1).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.crit">
<code class="descclassname">core.</code><code class="descname">crit</code><a class="headerlink" href="#core.crit" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “critical” (2).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.err">
<code class="descclassname">core.</code><code class="descname">err</code><a class="headerlink" href="#core.err" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “error” (3).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.warning">
<code class="descclassname">core.</code><code class="descname">warning</code><a class="headerlink" href="#core.warning" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “warning” (4).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.notice">
<code class="descclassname">core.</code><code class="descname">notice</code><a class="headerlink" href="#core.notice" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “notice” (5).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.info">
<code class="descclassname">core.</code><code class="descname">info</code><a class="headerlink" href="#core.info" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “info” (6).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.debug">
<code class="descclassname">core.</code><code class="descname">debug</code><a class="headerlink" href="#core.debug" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>This attribute is an integer, it contains the value of the loglevel “debug” (7).</p>
</dd></dl>

<dl class="attribute">
<dt id="core.proxies">
<code class="descclassname">core.</code><code class="descname">proxies</code><a class="headerlink" href="#core.proxies" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: task, action, sample-fetch, converter</p>
<p>This attribute is a table of declared proxies (frontend and backends). Each
proxy give an access to his list of listeners and servers. The table is
indexed by proxy name, and each entry is of type <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a>.</p>
<p>Warning, if you are declared frontend and backend with the same name, only one
of these are listed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#core.backends" title="core.backends"><code class="xref js js-attr docutils literal"><span class="pre">core.backends</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#core.frontends" title="core.frontends"><code class="xref js js-attr docutils literal"><span class="pre">core.frontends</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="core.backends">
<code class="descclassname">core.</code><code class="descname">backends</code><a class="headerlink" href="#core.backends" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: task, action, sample-fetch, converter</p>
<p>This attribute is a table of declared proxies with backend capability. Each
proxy give an access to his list of listeners and servers. The table is
indexed by the backend name, and each entry is of type <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#core.proxies" title="core.proxies"><code class="xref js js-attr docutils literal"><span class="pre">core.proxies</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#core.frontends" title="core.frontends"><code class="xref js js-attr docutils literal"><span class="pre">core.frontends</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="core.frontends">
<code class="descclassname">core.</code><code class="descname">frontends</code><a class="headerlink" href="#core.frontends" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: task, action, sample-fetch, converter</p>
<p>This attribute is a table of declared proxies with frontend capability. Each
proxy give an access to his list of listeners and servers. The table is
indexed by the frontend name, and each entry is of type <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#core.proxies" title="core.proxies"><code class="xref js js-attr docutils literal"><span class="pre">core.proxies</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#core.backends" title="core.backends"><code class="xref js js-attr docutils literal"><span class="pre">core.backends</span></code></a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.log">
<code class="descclassname">core.</code><code class="descname">log</code><span class="sig-paren">(</span><em>loglevel</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#core.log" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<p>This function sends a log. The log is sent, according with the HAProxy
configuration file, on the default syslog server if it is configured and on
the stderr if it is allowed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>loglevel</strong> (<em>integer</em>) – Is the log level associated with the message. It is a
number between 0 and 7.</li>
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.emerg" title="core.emerg"><code class="xref js js-attr docutils literal"><span class="pre">core.emerg</span></code></a>, <a class="reference internal" href="#core.alert" title="core.alert"><code class="xref js js-attr docutils literal"><span class="pre">core.alert</span></code></a>, <a class="reference internal" href="#core.crit" title="core.crit"><code class="xref js js-attr docutils literal"><span class="pre">core.crit</span></code></a>,
<a class="reference internal" href="#core.err" title="core.err"><code class="xref js js-attr docutils literal"><span class="pre">core.err</span></code></a>, <a class="reference internal" href="#core.warning" title="core.warning"><code class="xref js js-attr docutils literal"><span class="pre">core.warning</span></code></a>, <a class="reference internal" href="#core.notice" title="core.notice"><code class="xref js js-attr docutils literal"><span class="pre">core.notice</span></code></a>,
<a class="reference internal" href="#core.info" title="core.info"><code class="xref js js-attr docutils literal"><span class="pre">core.info</span></code></a>, <a class="reference internal" href="#core.debug" title="core.debug"><code class="xref js js-attr docutils literal"><span class="pre">core.debug</span></code></a> (log level definitions)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.Debug" title="core.Debug"><code class="xref js js-func docutils literal"><span class="pre">core.Debug()</span></code></a></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.Info" title="core.Info"><code class="xref js js-func docutils literal"><span class="pre">core.Info()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.Warning" title="core.Warning"><code class="xref js js-func docutils literal"><span class="pre">core.Warning()</span></code></a></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#core.Alert" title="core.Alert"><code class="xref js js-func docutils literal"><span class="pre">core.Alert()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.Debug">
<code class="descclassname">core.</code><code class="descname">Debug</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#core.Debug" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#core.log" title="core.log"><code class="xref js js-func docutils literal"><span class="pre">core.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Does the same job than:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
  <span class="n">core</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">core</span><span class="p">.</span><span class="n">debug</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="core.Info">
<code class="descclassname">core.</code><code class="descname">Info</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#core.Info" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#core.log" title="core.log"><code class="xref js js-func docutils literal"><span class="pre">core.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
  <span class="n">core</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">core</span><span class="p">.</span><span class="n">info</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="core.Warning">
<code class="descclassname">core.</code><code class="descname">Warning</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#core.Warning" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#core.log" title="core.log"><code class="xref js js-func docutils literal"><span class="pre">core.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
  <span class="n">core</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">core</span><span class="p">.</span><span class="n">warning</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="core.Alert">
<code class="descclassname">core.</code><code class="descname">Alert</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#core.Alert" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#core.log" title="core.log"><code class="xref js js-func docutils literal"><span class="pre">core.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Alert</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
  <span class="n">core</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">core</span><span class="p">.</span><span class="n">alert</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="core.add_acl">
<code class="descclassname">core.</code><code class="descname">add_acl</code><span class="sig-paren">(</span><em>filename</em>, <em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#core.add_acl" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: init, task, action, sample-fetch, converter</p>
<p>Add the ACL <em>key</em> in the ACLs list referenced by the file <em>filename</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> (<em>string</em>) – the filename that reference the ACL entries.</li>
<li><strong>key</strong> (<em>string</em>) – the key which will be added.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.del_acl">
<code class="descclassname">core.</code><code class="descname">del_acl</code><span class="sig-paren">(</span><em>filename</em>, <em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#core.del_acl" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: init, task, action, sample-fetch, converter</p>
<p>Delete the ACL entry referenced by the key <em>key</em> in the list of ACLs
referenced by <em>filename</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> (<em>string</em>) – the filename that reference the ACL entries.</li>
<li><strong>key</strong> (<em>string</em>) – the key which will be deleted.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.del_map">
<code class="descclassname">core.</code><code class="descname">del_map</code><span class="sig-paren">(</span><em>filename</em>, <em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#core.del_map" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: init, task, action, sample-fetch, converter</p>
<p>Delete the map entry indexed with the specified key in the list of maps
referenced by his filename.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> (<em>string</em>) – the filename that reference the map entries.</li>
<li><strong>key</strong> (<em>string</em>) – the key which will be deleted.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.get_info">
<code class="descclassname">core.</code><code class="descname">get_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#core.get_info" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<p>Returns HAProxy core informations. We can found information like the uptime,
the pid, memory pool usage, tasks number, …</p>
<p>These information are also returned by the management socket via the command
“show info”. See the management socket documentation for more information
about the content of these variables.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">an array of values.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.now">
<code class="descclassname">core.</code><code class="descname">now</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#core.now" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>This function returns the current time. The time returned is fixed by the
HAProxy core and assures than the hour will be monotonic and that the system
call ‘gettimeofday’ will not be called too. The time is refreshed between each
Lua execution or resume, so two consecutive call to the function “now” will
probably returns the same result.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a table which contains two entries “sec” and “usec”. “sec”
contains the current at the epoch format, and “usec” contains the
current microseconds.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.http_date">
<code class="descclassname">core.</code><code class="descname">http_date</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#core.http_date" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>This function take a string representing http date, and returns an integer
containing the corresponding date with a epoch format. A valid http date
me respect the format IMF, RFC850 or ASCTIME.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>date</strong> (<em>string</em>) – a date http-date formatted</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">integer containing epoch date</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.imf_date" title="core.imf_date"><code class="xref js js-func docutils literal"><span class="pre">core.imf_date()</span></code></a>.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.rfc850_date" title="core.rfc850_date"><code class="xref js js-func docutils literal"><span class="pre">core.rfc850_date()</span></code></a>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.asctime_date" title="core.asctime_date"><code class="xref js js-func docutils literal"><span class="pre">core.asctime_date()</span></code></a>.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://tools.ietf.org/html/rfc7231#section-7.1.1.1">https://tools.ietf.org/html/rfc7231#section-7.1.1.1</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.imf_date">
<code class="descclassname">core.</code><code class="descname">imf_date</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#core.imf_date" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>This function take a string representing IMF date, and returns an integer
containing the corresponding date with a epoch format.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>date</strong> (<em>string</em>) – a date IMF formatted</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">integer containing epoch date</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://tools.ietf.org/html/rfc7231#section-7.1.1.1">https://tools.ietf.org/html/rfc7231#section-7.1.1.1</a></p>
</td>
</tr>
</tbody>
</table>
<p>The IMF format is like this:</p>
</dd></dl>

<div class="highlight-text"><div class="highlight"><pre><span></span>Sun, 06 Nov 1994 08:49:37 GMT
</pre></div>
</div>
<dl class="function">
<dt id="core.rfc850_date">
<code class="descclassname">core.</code><code class="descname">rfc850_date</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#core.rfc850_date" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>This function take a string representing RFC850 date, and returns an integer
containing the corresponding date with a epoch format.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>date</strong> (<em>string</em>) – a date RFC859 formatted</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">integer containing epoch date</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://tools.ietf.org/html/rfc7231#section-7.1.1.1">https://tools.ietf.org/html/rfc7231#section-7.1.1.1</a></p>
</td>
</tr>
</tbody>
</table>
<p>The RFC850 format is like this:</p>
</dd></dl>

<div class="highlight-text"><div class="highlight"><pre><span></span>Sunday, 06-Nov-94 08:49:37 GMT
</pre></div>
</div>
<dl class="function">
<dt id="core.asctime_date">
<code class="descclassname">core.</code><code class="descname">asctime_date</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span><a class="headerlink" href="#core.asctime_date" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>This function take a string representing ASCTIME date, and returns an integer
containing the corresponding date with a epoch format.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>date</strong> (<em>string</em>) – a date ASCTIME formatted</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">integer containing epoch date</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://tools.ietf.org/html/rfc7231#section-7.1.1.1">https://tools.ietf.org/html/rfc7231#section-7.1.1.1</a></p>
</td>
</tr>
</tbody>
</table>
<p>The ASCTIME format is like this:</p>
</dd></dl>

<div class="highlight-text"><div class="highlight"><pre><span></span>Sun Nov  6 08:49:37 1994
</pre></div>
</div>
<dl class="function">
<dt>
<code class="descclassname">core.</code><code class="descname">rfc850_date</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>This function take a string representing http date, and returns an integer
containing the corresponding date with a epoch format.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>date</strong> (<em>string</em>) – a date http-date formatted</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt>
<code class="descclassname">core.</code><code class="descname">asctime_date</code><span class="sig-paren">(</span><em>date</em><span class="sig-paren">)</span></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>This function take a string representing http date, and returns an integer
containing the corresponding date with a epoch format.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>date</strong> (<em>string</em>) – a date http-date formatted</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.msleep">
<code class="descclassname">core.</code><code class="descname">msleep</code><span class="sig-paren">(</span><em>milliseconds</em><span class="sig-paren">)</span><a class="headerlink" href="#core.msleep" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>The <cite>core.msleep()</cite> stops the Lua execution between specified milliseconds.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>milliseconds</strong> (<em>integer</em>) – the required milliseconds.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descclassname">core.</code><code class="descname">proxies</code></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<p>Proxies is a table containing the list of all proxies declared in the
configuration file. The table is indexed by the proxy name, and each entry
of the proxies table is an object of type <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a>.</p>
<p>Warning, if you have declared a frontend and backend with the same name, only
one of these are listed.</p>
</dd></dl>

<dl class="function">
<dt id="core.register_action">
<code class="descclassname">core.</code><code class="descname">register_action</code><span class="sig-paren">(</span><em>name</em>, <em>actions</em>, <em>func</em><span class="optional">[</span>, <em>nb_args</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#core.register_action" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body</p>
<p>Register a Lua function executed as action. All the registered action can be
used in HAProxy with the prefix “lua.”. An action gets a TXN object class as
input.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>string</em>) – is the name of the converter.</li>
<li><strong>actions</strong> (<em>table</em>) – is a table of string describing the HAProxy actions who
want to register to. The expected actions are ‘tcp-req’,
‘tcp-res’, ‘http-req’ or ‘http-res’.</li>
<li><strong>nb_args</strong> (<em>integer</em>) – is the expected number of argument for the action.
By default the value is 0.</li>
<li><strong>func</strong> (<em>function</em>) – is the Lua function called to work as converter.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The prototype of the Lua function used as argument is:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span><span class="p">(</span><span class="n">txn</span> <span class="p">[,</span> <span class="n">arg1</span> <span class="p">[,</span> <span class="n">arg2</span><span class="p">]])</span>
</pre></div>
</div>
<blockquote>
<div><ul class="simple">
<li><dl class="first docutils">
<dt><strong>txn</strong> (<a class="reference internal" href="#txn-class"><span class="std std-ref">TXN class</span></a>): this is a TXN object used for manipulating the</dt>
<dd>current request or TCP stream.</dd>
</dl>
</li>
<li><strong>argX</strong>: this is argument provided through the HAProxy configuration file.</li>
</ul>
<p>Here, an example of action registration. The action just send an ‘Hello world’
in the logs.</p>
</div></blockquote>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">core</span><span class="p">.</span><span class="n">register_action</span><span class="p">(</span><span class="s2">&quot;hello-world&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;tcp-req&quot;</span><span class="p">,</span> <span class="s2">&quot;http-req&quot;</span> <span class="p">},</span> <span class="kr">function</span><span class="p">(</span><span class="n">txn</span><span class="p">)</span>
   <span class="n">txn</span><span class="p">:</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;Hello world&quot;</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>This example code is used in HAproxy configuration like this:</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">frontend</span> <span class="n">tcp_frt</span>
  <span class="n">mode</span> <span class="n">tcp</span>
  <span class="n">tcp</span><span class="o">-</span><span class="n">request</span> <span class="n">content</span> <span class="n">lua</span><span class="o">.</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>

<span class="n">frontend</span> <span class="n">http_frt</span>
  <span class="n">mode</span> <span class="n">http</span>
  <span class="n">http</span><span class="o">-</span><span class="n">request</span> <span class="n">lua</span><span class="o">.</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
<blockquote>
<div>A second example using arguments</div></blockquote>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
   <span class="n">txn</span><span class="p">:</span><span class="n">Info</span><span class="p">(</span><span class="s2">&quot;Hello world for &quot;</span> <span class="o">..</span> <span class="n">arg</span><span class="p">)</span>
<span class="kr">end</span>
<span class="n">core</span><span class="p">.</span><span class="n">register_action</span><span class="p">(</span><span class="s2">&quot;hello-world&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;tcp-req&quot;</span><span class="p">,</span> <span class="s2">&quot;http-req&quot;</span> <span class="p">},</span> <span class="n">hello_world</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>This example code is used in HAproxy configuration like this:</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">frontend</span> <span class="n">tcp_frt</span>
  <span class="n">mode</span> <span class="n">tcp</span>
  <span class="n">tcp</span><span class="o">-</span><span class="n">request</span> <span class="n">content</span> <span class="n">lua</span><span class="o">.</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span> <span class="n">everybody</span>
</pre></div>
</div>
<dl class="function">
<dt id="core.register_converters">
<code class="descclassname">core.</code><code class="descname">register_converters</code><span class="sig-paren">(</span><em>name</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#core.register_converters" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body</p>
<p>Register a Lua function executed as converter. All the registered converters
can be used in HAProxy with the prefix “lua.”. An converter get a string as
input and return a string as output. The registered function can take up to 9
values as parameter. All the value are strings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>string</em>) – is the name of the converter.</li>
<li><strong>func</strong> (<em>function</em>) – is the Lua function called to work as converter.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The prototype of the Lua function used as argument is:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="p">[</span><span class="n">p1</span> <span class="p">[,</span> <span class="n">p2</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">[,</span> <span class="n">p5</span><span class="p">]]]])</span>
</pre></div>
</div>
<blockquote>
<div><ul class="simple">
<li><strong>str</strong> (<em>string</em>): this is the input value automatically converted in
string.</li>
<li><strong>p1</strong> .. <strong>p5</strong> (<em>string</em>): this is a list of string arguments declared in
the HAProxy configuration file. The number of arguments doesn’t exceed 5.
The order and the nature of these is conventionally choose by the
developer.</li>
</ul>
</div></blockquote>
<dl class="function">
<dt id="core.register_fetches">
<code class="descclassname">core.</code><code class="descname">register_fetches</code><span class="sig-paren">(</span><em>name</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#core.register_fetches" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body</p>
<p>Register a Lua function executed as sample fetch. All the registered sample
fetch can be used in HAProxy with the prefix “lua.”. A Lua sample fetch
return a string as output. The registered function can take up to 9 values as
parameter. All the value are strings.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>string</em>) – is the name of the converter.</li>
<li><strong>func</strong> (<em>function</em>) – is the Lua function called to work as sample fetch.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The prototype of the Lua function used as argument is:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">string</span> <span class="kr">function</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="p">[</span><span class="n">p1</span> <span class="p">[,</span> <span class="n">p2</span> <span class="p">[,</span> <span class="p">...</span> <span class="p">[,</span> <span class="n">p5</span><span class="p">]]]])</span>
</pre></div>
</div>
<blockquote>
<div><ul class="simple">
<li><strong>txn</strong> (<a class="reference internal" href="#txn-class"><span class="std std-ref">TXN class</span></a>): this is the txn object associated with the current
request.</li>
<li><strong>p1</strong> .. <strong>p5</strong> (<em>string</em>): this is a list of string arguments declared in
the HAProxy configuration file. The number of arguments doesn’t exceed 5.
The order and the nature of these is conventionally choose by the
developer.</li>
<li><strong>Returns</strong>: A string containing some data, or nil if the value cannot be
returned now.</li>
</ul>
<p>lua example code:</p>
</div></blockquote>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">core</span><span class="p">.</span><span class="n">register_fetches</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">txn</span><span class="p">)</span>
    <span class="kr">return</span> <span class="s2">&quot;hello&quot;</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>HAProxy example configuration:</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">frontend</span> <span class="n">example</span>
   <span class="n">http</span><span class="o">-</span><span class="n">request</span> <span class="n">redirect</span> <span class="n">location</span> <span class="o">/%</span><span class="p">[</span><span class="n">lua</span><span class="o">.</span><span class="n">hello</span><span class="p">]</span>
</pre></div>
</div>
<dl class="function">
<dt id="core.register_service">
<code class="descclassname">core.</code><code class="descname">register_service</code><span class="sig-paren">(</span><em>name</em>, <em>mode</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#core.register_service" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body</p>
<p>Register a Lua function executed as a service. All the registered service can
be used in HAProxy with the prefix “lua.”. A service gets an object class as
input according with the required mode.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>string</em>) – is the name of the converter.</li>
<li><strong>mode</strong> (<em>string</em>) – is string describing the required mode. Only ‘tcp’ or
‘http’ are allowed.</li>
<li><strong>func</strong> (<em>function</em>) – is the Lua function called to work as converter.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The prototype of the Lua function used as argument is:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span><span class="p">(</span><span class="n">applet</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><ul class="simple">
<li><strong>applet</strong> <em>applet</em>  will be a <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a> or a
<a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a>. It depends the type of registered applet. An applet
registered with the ‘http’ value for the <em>mode</em> parameter will gets a
<a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a>. If the <em>mode</em> value is ‘tcp’, the applet will gets
a <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a>.</li>
</ul>
<p><strong>warning</strong>: Applets of type ‘http’ cannot be called from ‘tcp-<em>‘
rulesets. Only the ‘http-</em>‘ rulesets are authorized, this means
that is not possible to call an HTTP applet from a proxy in tcp
mode. Applets of type ‘tcp’ can be called from anywhere.</p>
<p>Here, an example of service registration. The service just send an ‘Hello world’
as an http response.</p>
</div></blockquote>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">core</span><span class="p">.</span><span class="n">register_service</span><span class="p">(</span><span class="s2">&quot;hello-world&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">applet</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;Hello World !&quot;</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">set_status</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">,</span> <span class="nb">string.len</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">start_response</span><span class="p">()</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>This example code is used in HAproxy configuration like this:</div></blockquote>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">frontend</span> <span class="n">example</span>
   <span class="n">http</span><span class="o">-</span><span class="n">request</span> <span class="n">use</span><span class="o">-</span><span class="n">service</span> <span class="n">lua</span><span class="o">.</span><span class="n">hello</span><span class="o">-</span><span class="n">world</span>
</pre></div>
</div>
<dl class="function">
<dt id="core.register_init">
<code class="descclassname">core.</code><code class="descname">register_init</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#core.register_init" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body</p>
<p>Register a function executed after the configuration parsing. This is useful
to check any parameters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>func</strong> (<em>function</em>) – is the Lua function called to work as initializer.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The prototype of the Lua function used as argument is:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span><span class="p">()</span>
</pre></div>
</div>
<blockquote>
<div>It takes no input, and no output is expected.</div></blockquote>
<dl class="function">
<dt id="core.register_task">
<code class="descclassname">core.</code><code class="descname">register_task</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#core.register_task" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<p>Register and start independent task. The task is started when the HAProxy
main scheduler starts. For example this type of tasks can be executed to
perform complex health checks.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>func</strong> (<em>function</em>) – is the Lua function called to work as initializer.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The prototype of the Lua function used as argument is:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span><span class="p">()</span>
</pre></div>
</div>
<blockquote>
<div>It takes no input, and no output is expected.</div></blockquote>
<dl class="function">
<dt id="core.register_cli">
<code class="descclassname">core.</code><code class="descname">register_cli</code><span class="sig-paren">(</span><span class="optional">[</span><em>path</em>, <span class="optional">]</span><em>usage</em>, <em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#core.register_cli" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body</p>
<p>Register and start independent task. The task is started when the HAProxy
main scheduler starts. For example this type of tasks can be executed to
perform complex health checks.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> (<em>array</em>) – is the sequence of word for which the cli execute the Lua
binding.</li>
<li><strong>usage</strong> (<em>string</em>) – is the usage message displayed in the help.</li>
<li><strong>func</strong> (<em>function</em>) – is the Lua function called to handle the CLI commands.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The prototype of the Lua function used as argument is:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span><span class="p">(</span><span class="n">AppletTCP</span><span class="p">,</span> <span class="p">[</span><span class="n">arg1</span><span class="p">,</span> <span class="p">[</span><span class="n">arg2</span><span class="p">,</span> <span class="p">[...]]])</span>
</pre></div>
</div>
<blockquote>
<div>I/O are managed with the <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a> object. Args are given as
parameter. The args embed the registered path. If the path is declared like
this:</div></blockquote>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">core</span><span class="p">.</span><span class="n">register_cli</span><span class="p">({</span><span class="s2">&quot;show&quot;</span><span class="p">,</span> <span class="s2">&quot;ssl&quot;</span><span class="p">,</span> <span class="s2">&quot;stats&quot;</span><span class="p">},</span> <span class="s2">&quot;Display SSL stats..&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">applet</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">,</span> <span class="n">arg4</span><span class="p">,</span> <span class="n">arg5</span><span class="p">)</span>
     <span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>And we execute this in the prompt:</div></blockquote>
<div class="highlight-text"><div class="highlight"><pre><span></span>&gt; prompt
&gt; show ssl stats all
</pre></div>
</div>
<blockquote>
<div>Then, arg1, arg2 and arg3 will contains respectively “show”, “ssl” and “stats”.
arg4 will contain “all”. arg5 contains nil.</div></blockquote>
<dl class="function">
<dt id="core.set_nice">
<code class="descclassname">core.</code><code class="descname">set_nice</code><span class="sig-paren">(</span><em>nice</em><span class="sig-paren">)</span><a class="headerlink" href="#core.set_nice" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: task, action, sample-fetch, converter</p>
<p>Change the nice of the current task or current session.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>nice</strong> (<em>integer</em>) – the nice value, it must be between -1024 and 1024.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.set_map">
<code class="descclassname">core.</code><code class="descname">set_map</code><span class="sig-paren">(</span><em>filename</em>, <em>key</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#core.set_map" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: init, task, action, sample-fetch, converter</p>
<p>Set the value <em>value</em> associated to the key <em>key</em> in the map referenced by
<em>filename</em>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> (<em>string</em>) – the Map reference</li>
<li><strong>key</strong> (<em>string</em>) – the key to set or replace</li>
<li><strong>value</strong> (<em>string</em>) – the associated value</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.sleep">
<code class="descclassname">core.</code><code class="descname">sleep</code><span class="sig-paren">(</span><em>int seconds</em><span class="sig-paren">)</span><a class="headerlink" href="#core.sleep" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action</p>
<p>The <cite>core.sleep()</cite> functions stop the Lua execution between specified seconds.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>seconds</strong> (<em>integer</em>) – the required seconds.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.tcp">
<code class="descclassname">core.</code><code class="descname">tcp</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#core.tcp" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: init, task, action</p>
<p>This function returns a new object of a <em>socket</em> class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#socket-class"><span class="std std-ref">Socket class</span></a> object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.concat">
<code class="descclassname">core.</code><code class="descname">concat</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#core.concat" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<p>This function returns a new concat object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#concat-class"><span class="std std-ref">Concat class</span></a> object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="core.done">
<code class="descclassname">core.</code><code class="descname">done</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#core.done" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<em>any</em>) – Return some data for the caller. It is useful with
sample-fetches and sample-converters.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Immediately stops the current Lua execution and returns to the caller which
may be a sample fetch, a converter or an action and returns the specified
value (ignored for actions). It is used when the LUA process finishes its
work and wants to give back the control to HAProxy without executing the
remaining code. It can be seen as a multi-level “return”.</p>
</dd></dl>

<dl class="function">
<dt id="core.yield">
<code class="descclassname">core.</code><code class="descname">yield</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#core.yield" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: task, action, sample-fetch, converter</p>
<p>Give back the hand at the HAProxy scheduler. It is used when the LUA
processing consumes a lot of processing time.</p>
</dd></dl>

<dl class="function">
<dt id="core.parse_addr">
<code class="descclassname">core.</code><code class="descname">parse_addr</code><span class="sig-paren">(</span><em>address</em><span class="sig-paren">)</span><a class="headerlink" href="#core.parse_addr" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>network</strong> – is a string describing an ipv4 or ipv6 address and optionally
its network length, like this: “127.0.0.1/8” or “aaaa::1234/32”.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a userdata containing network or nil if an error occurs.</p>
</td>
</tr>
</tbody>
</table>
<p>Parse ipv4 or ipv6 addresses and its facultative associated network.</p>
</dd></dl>

<dl class="function">
<dt id="core.match_addr">
<code class="descclassname">core.</code><code class="descname">match_addr</code><span class="sig-paren">(</span><em>addr1</em>, <em>addr2</em><span class="sig-paren">)</span><a class="headerlink" href="#core.match_addr" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>addr1</strong> – is an address created with “core.parse_addr”.</li>
<li><strong>addr2</strong> – is an address created with “core.parse_addr”.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean, true if the network of the addresses match, else returns
false.</p>
</td>
</tr>
</tbody>
</table>
<p>Match two networks. For example “127.0.0.1/32” matchs “127.0.0.0/8”. The order
of network is not important.</p>
</dd></dl>

<dl class="function">
<dt id="core.tokenize">
<code class="descclassname">core.</code><code class="descname">tokenize</code><span class="sig-paren">(</span><em>str</em>, <em>separators</em><span class="optional">[</span>, <em>noblank</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#core.tokenize" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: body, init, task, action, sample-fetch, converter</p>
<p>This function is useful for tokenizing an entry, or splitting some messages.
:param string str: The string which will be split.
:param string separators: A string containing a list of separators.
:param boolean noblank: Ignore empty entries.
:returns: an array of string.</p>
<p>For example:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">array</span> <span class="o">=</span> <span class="n">core</span><span class="p">.</span><span class="n">tokenize</span><span class="p">(</span><span class="s2">&quot;This function is useful, for tokenizing an entry.&quot;</span><span class="p">,</span> <span class="s2">&quot;., &quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="n">print_r</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div>Returns this array:</div></blockquote>
<div class="highlight-text"><div class="highlight"><pre><span></span>(table) table: 0x21c01e0 [
    1: (string) &quot;This&quot;
    2: (string) &quot;function&quot;
    3: (string) &quot;is&quot;
    4: (string) &quot;useful&quot;
    5: (string) &quot;for&quot;
    6: (string) &quot;tokenizing&quot;
    7: (string) &quot;an&quot;
    8: (string) &quot;entry&quot;
]
</pre></div>
</div>
</div>
<div class="section" id="proxy-class">
<span id="id1"></span><h1>Proxy class<a class="headerlink" href="#proxy-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Proxy">
<em class="property">class </em><code class="descname">Proxy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Proxy" title="Permalink to this definition">¶</a></dt>
<dd><p>This class provides a way for manipulating proxy and retrieving information
like statistics.</p>
</dd></dl>

<dl class="attribute">
<dt id="Proxy.name">
<code class="descclassname">Proxy.</code><code class="descname">name</code><a class="headerlink" href="#Proxy.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Contain the name of the proxy.</p>
</dd></dl>

<dl class="attribute">
<dt id="Proxy.uuid">
<code class="descclassname">Proxy.</code><code class="descname">uuid</code><a class="headerlink" href="#Proxy.uuid" title="Permalink to this definition">¶</a></dt>
<dd><p>Contain the unique identifier of the proxy.</p>
</dd></dl>

<dl class="attribute">
<dt id="Proxy.servers">
<code class="descclassname">Proxy.</code><code class="descname">servers</code><a class="headerlink" href="#Proxy.servers" title="Permalink to this definition">¶</a></dt>
<dd><p>Contain a table with the attached servers. The table is indexed by server
name, and each server entry is an object of type <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="Proxy.stktable">
<code class="descclassname">Proxy.</code><code class="descname">stktable</code><a class="headerlink" href="#Proxy.stktable" title="Permalink to this definition">¶</a></dt>
<dd><p>Contains a stick table object attached to the proxy.</p>
</dd></dl>

<dl class="attribute">
<dt id="Proxy.listeners">
<code class="descclassname">Proxy.</code><code class="descname">listeners</code><a class="headerlink" href="#Proxy.listeners" title="Permalink to this definition">¶</a></dt>
<dd><p>Contain a table with the attached listeners. The table is indexed by listener
name, and each each listeners entry is an object of type
<a class="reference internal" href="#listener-class"><span class="std std-ref">Listener class</span></a>.</p>
</dd></dl>

<dl class="function">
<dt id="Proxy.pause">
<code class="descclassname">Proxy.</code><code class="descname">pause</code><span class="sig-paren">(</span><em>px</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.pause" title="Permalink to this definition">¶</a></dt>
<dd><p>Pause the proxy. See the management socket documentation for more information.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>px</strong> (<em>class_proxy</em>) – A <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a> which indicates the manipulated
proxy.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Proxy.resume">
<code class="descclassname">Proxy.</code><code class="descname">resume</code><span class="sig-paren">(</span><em>px</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.resume" title="Permalink to this definition">¶</a></dt>
<dd><p>Resume the proxy. See the management socket documentation for more
information.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>px</strong> (<em>class_proxy</em>) – A <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a> which indicates the manipulated
proxy.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Proxy.stop">
<code class="descclassname">Proxy.</code><code class="descname">stop</code><span class="sig-paren">(</span><em>px</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop the proxy. See the management socket documentation for more information.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>px</strong> (<em>class_proxy</em>) – A <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a> which indicates the manipulated
proxy.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Proxy.shut_bcksess">
<code class="descclassname">Proxy.</code><code class="descname">shut_bcksess</code><span class="sig-paren">(</span><em>px</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.shut_bcksess" title="Permalink to this definition">¶</a></dt>
<dd><p>Kill the session attached to a backup server. See the management socket
documentation for more information.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>px</strong> (<em>class_proxy</em>) – A <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a> which indicates the manipulated
proxy.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Proxy.get_cap">
<code class="descclassname">Proxy.</code><code class="descname">get_cap</code><span class="sig-paren">(</span><em>px</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.get_cap" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string describing the capabilities of the proxy.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>px</strong> (<em>class_proxy</em>) – A <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a> which indicates the manipulated
proxy.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string “frontend”, “backend”, “proxy” or “ruleset”.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Proxy.get_mode">
<code class="descclassname">Proxy.</code><code class="descname">get_mode</code><span class="sig-paren">(</span><em>px</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.get_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string describing the mode of the current proxy.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>px</strong> (<em>class_proxy</em>) – A <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a> which indicates the manipulated
proxy.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string “tcp”, “http”, “health” or “unknown”</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Proxy.get_stats">
<code class="descclassname">Proxy.</code><code class="descname">get_stats</code><span class="sig-paren">(</span><em>px</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.get_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a table containing the proxy statistics. The statistics returned are
not the same if the proxy is frontend or a backend.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>px</strong> (<em>class_proxy</em>) – A <a class="reference internal" href="#proxy-class"><span class="std std-ref">Proxy class</span></a> which indicates the manipulated
proxy.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a key/value table containing stats</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="server-class">
<span id="id2"></span><h1>Server class<a class="headerlink" href="#server-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Server">
<em class="property">class </em><code class="descname">Server</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Server" title="Permalink to this definition">¶</a></dt>
<dd><p>This class provides a way for manipulating servers and retrieving information.</p>
</dd></dl>

<dl class="attribute">
<dt id="Server.name">
<code class="descclassname">Server.</code><code class="descname">name</code><a class="headerlink" href="#Server.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Contain the name of the server.</p>
</dd></dl>

<dl class="attribute">
<dt id="Server.puid">
<code class="descclassname">Server.</code><code class="descname">puid</code><a class="headerlink" href="#Server.puid" title="Permalink to this definition">¶</a></dt>
<dd><p>Contain the proxy unique identifier of the server.</p>
</dd></dl>

<dl class="function">
<dt id="Server.is_draining">
<code class="descclassname">Server.</code><code class="descname">is_draining</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.is_draining" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if the server is currently draining sticky connections.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a boolean</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.set_maxconn">
<code class="descclassname">Server.</code><code class="descname">set_maxconn</code><span class="sig-paren">(</span><em>sv</em>, <em>weight</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.set_maxconn" title="Permalink to this definition">¶</a></dt>
<dd><p>Dynamically change the maximum connections of the server. See the management
socket documentation for more information about the format of the string.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
<li><strong>maxconn</strong> (<em>string</em>) – A string describing the server maximum connections.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.get_maxconn">
<code class="descclassname">Server.</code><code class="descname">get_maxconn</code><span class="sig-paren">(</span><em>sv</em>, <em>weight</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.get_maxconn" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns an integer representing the server maximum connections.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an integer.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.set_weight">
<code class="descclassname">Server.</code><code class="descname">set_weight</code><span class="sig-paren">(</span><em>sv</em>, <em>weight</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.set_weight" title="Permalink to this definition">¶</a></dt>
<dd><p>Dynamically change the weight of the server. See the management socket
documentation for more information about the format of the string.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
<li><strong>weight</strong> (<em>string</em>) – A string describing the server weight.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.get_weight">
<code class="descclassname">Server.</code><code class="descname">get_weight</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.get_weight" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns an integer representing the server weight.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an integer.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.set_addr">
<code class="descclassname">Server.</code><code class="descname">set_addr</code><span class="sig-paren">(</span><em>sv</em>, <em>addr</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.set_addr" title="Permalink to this definition">¶</a></dt>
<dd><p>Dynamically change the address of the server. See the management socket
documentation for more information about the format of the string.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
<li><strong>addr</strong> (<em>string</em>) – A string describing the server address.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.get_addr">
<code class="descclassname">Server.</code><code class="descname">get_addr</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.get_addr" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string describing the address of the server.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A string</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.get_stats">
<code class="descclassname">Server.</code><code class="descname">get_stats</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.get_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns server statistics.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a key/value table containing stats</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.shut_sess">
<code class="descclassname">Server.</code><code class="descname">shut_sess</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.shut_sess" title="Permalink to this definition">¶</a></dt>
<dd><p>Shutdown all the sessions attached to the server. See the management socket
documentation for more information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.set_drain">
<code class="descclassname">Server.</code><code class="descname">set_drain</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.set_drain" title="Permalink to this definition">¶</a></dt>
<dd><p>Drain sticky sessions. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.set_maint">
<code class="descclassname">Server.</code><code class="descname">set_maint</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.set_maint" title="Permalink to this definition">¶</a></dt>
<dd><p>Set maintenance mode. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.set_ready">
<code class="descclassname">Server.</code><code class="descname">set_ready</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.set_ready" title="Permalink to this definition">¶</a></dt>
<dd><p>Set normal mode. See the management socket documentation for more information
about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.check_enable">
<code class="descclassname">Server.</code><code class="descname">check_enable</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.check_enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable health checks. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.check_disable">
<code class="descclassname">Server.</code><code class="descname">check_disable</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.check_disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable health checks. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.check_force_up">
<code class="descclassname">Server.</code><code class="descname">check_force_up</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.check_force_up" title="Permalink to this definition">¶</a></dt>
<dd><p>Force health-check up. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.check_force_nolb">
<code class="descclassname">Server.</code><code class="descname">check_force_nolb</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.check_force_nolb" title="Permalink to this definition">¶</a></dt>
<dd><p>Force health-check nolb mode. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.check_force_down">
<code class="descclassname">Server.</code><code class="descname">check_force_down</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.check_force_down" title="Permalink to this definition">¶</a></dt>
<dd><p>Force health-check down. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.agent_enable">
<code class="descclassname">Server.</code><code class="descname">agent_enable</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.agent_enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable agent check. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.agent_disable">
<code class="descclassname">Server.</code><code class="descname">agent_disable</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.agent_disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable agent check. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.agent_force_up">
<code class="descclassname">Server.</code><code class="descname">agent_force_up</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.agent_force_up" title="Permalink to this definition">¶</a></dt>
<dd><p>Force agent check up. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Server.agent_force_down">
<code class="descclassname">Server.</code><code class="descname">agent_force_down</code><span class="sig-paren">(</span><em>sv</em><span class="sig-paren">)</span><a class="headerlink" href="#Server.agent_force_down" title="Permalink to this definition">¶</a></dt>
<dd><p>Force agent check down. See the management socket documentation for more
information about this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>sv</strong> (<em>class_server</em>) – A <a class="reference internal" href="#server-class"><span class="std std-ref">Server class</span></a> which indicates the manipulated
server.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="listener-class">
<span id="id3"></span><h1>Listener class<a class="headerlink" href="#listener-class" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="Listener.get_stats">
<code class="descclassname">Listener.</code><code class="descname">get_stats</code><span class="sig-paren">(</span><em>ls</em><span class="sig-paren">)</span><a class="headerlink" href="#Listener.get_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns server statistics.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>ls</strong> (<em>class_listener</em>) – A <a class="reference internal" href="#listener-class"><span class="std std-ref">Listener class</span></a> which indicates the
manipulated listener.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a key/value table containing stats</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="concat-class">
<span id="id4"></span><h1>Concat class<a class="headerlink" href="#concat-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Concat">
<em class="property">class </em><code class="descname">Concat</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Concat" title="Permalink to this definition">¶</a></dt>
<dd><p>This class provides a fast way for string concatenation. The way using native
Lua concatenation like the code below is slow for some reasons.</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">str</span> <span class="o">=</span> <span class="s2">&quot;string1&quot;</span>
<span class="n">str</span> <span class="o">=</span> <span class="n">str</span> <span class="o">..</span> <span class="s2">&quot;, string2&quot;</span>
<span class="n">str</span> <span class="o">=</span> <span class="n">str</span> <span class="o">..</span> <span class="s2">&quot;, string3&quot;</span>
</pre></div>
</div>
<blockquote>
<div><p>For each concatenation, Lua:
* allocate memory for the result,
* catenate the two string copying the strings in the new memory bloc,
* free the old memory block containing the string which is no longer used.
This process does many memory move, allocation and free. In addition, the
memory is not really freed, it is just mark mark as unused and wait for the
garbage collector.</p>
<p>The Concat class provide an alternative way to concatenate strings. It uses
the internal Lua mechanism (it does not allocate memory), but it doesn’t copy
the data more than once.</p>
<p>On my computer, the following loops spends 0.2s for the Concat method and
18.5s for the pure Lua implementation. So, the Concat class is about 1000x
faster than the embedded solution.</p>
</div></blockquote>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span> <span class="kr">do</span>
  <span class="n">c</span> <span class="o">=</span> <span class="n">core</span><span class="p">.</span><span class="n">concat</span><span class="p">()</span>
  <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20000</span> <span class="kr">do</span>
    <span class="n">c</span><span class="p">:</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;#####&quot;</span><span class="p">)</span>
  <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span> <span class="kr">do</span>
  <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20000</span> <span class="kr">do</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span> <span class="o">..</span> <span class="s2">&quot;#####&quot;</span>
  <span class="kr">end</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="Concat.add">
<code class="descclassname">Concat.</code><code class="descname">add</code><span class="sig-paren">(</span><em>concat</em>, <em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#Concat.add" title="Permalink to this definition">¶</a></dt>
<dd><p>This function adds a string to the current concatenated string.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>concat</strong> (<em>class_concat</em>) – A <a class="reference internal" href="#concat-class"><span class="std std-ref">Concat class</span></a> which contains the currently
builded string.</li>
<li><strong>string</strong> (<em>string</em>) – A new string to concatenate to the current built
string.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Concat.dump">
<code class="descclassname">Concat.</code><code class="descname">dump</code><span class="sig-paren">(</span><em>concat</em><span class="sig-paren">)</span><a class="headerlink" href="#Concat.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns the concatenated string.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>concat</strong> (<em>class_concat</em>) – A <a class="reference internal" href="#concat-class"><span class="std std-ref">Concat class</span></a> which contains the currently
builded string.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the concatenated string</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="fetches-class">
<span id="id5"></span><h1>Fetches class<a class="headerlink" href="#fetches-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Fetches">
<em class="property">class </em><code class="descname">Fetches</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Fetches" title="Permalink to this definition">¶</a></dt>
<dd><p>This class contains a lot of internal HAProxy sample fetches. See the
HAProxy “configuration.txt” documentation for more information about her
usage. They are the chapters 7.3.2 to 7.3.6.</p>
<p><strong>warning</strong> some sample fetches are not available in some context. These
limitations are specified in this documentation when they’re useful.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#TXN.f" title="TXN.f"><code class="xref js js-attr docutils literal"><span class="pre">TXN.f</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#TXN.sf" title="TXN.sf"><code class="xref js js-attr docutils literal"><span class="pre">TXN.sf</span></code></a></td>
</tr>
</tbody>
</table>
<p>Fetches are useful for:</p>
<ul class="simple">
<li>get system time,</li>
<li>get environment variable,</li>
<li>get random numbers,</li>
<li>known backend status like the number of users in queue or the number of
connections established,</li>
<li>client information like ip source or destination,</li>
<li>deal with stick tables,</li>
<li>Established SSL informations,</li>
<li>HTTP information like headers or method.</li>
</ul>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">action</span><span class="p">(</span><span class="n">txn</span><span class="p">)</span>
  <span class="c1">-- Get source IP</span>
  <span class="kd">local</span> <span class="n">clientip</span> <span class="o">=</span> <span class="n">txn</span><span class="p">.</span><span class="n">f</span><span class="p">:</span><span class="n">src</span><span class="p">()</span>
<span class="kr">end</span>
</pre></div>
</div>
</div>
<div class="section" id="converters-class">
<span id="id6"></span><h1>Converters class<a class="headerlink" href="#converters-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Converters">
<em class="property">class </em><code class="descname">Converters</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Converters" title="Permalink to this definition">¶</a></dt>
<dd><p>This class contains a lot of internal HAProxy sample converters. See the
HAProxy documentation “configuration.txt” for more information about her
usage. Its the chapter 7.3.1.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#TXN.c" title="TXN.c"><code class="xref js js-attr docutils literal"><span class="pre">TXN.c</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><a class="reference internal" href="#TXN.sc" title="TXN.sc"><code class="xref js js-attr docutils literal"><span class="pre">TXN.sc</span></code></a></td>
</tr>
</tbody>
</table>
<p>Converters provides statefull transformation. They are useful for:</p>
<ul class="simple">
<li>converting input to base64,</li>
<li>applying hash on input string (djb2, crc32, sdbm, wt6),</li>
<li>format date,</li>
<li>json escape,</li>
<li>extracting preferred language comparing two lists,</li>
<li>turn to lower or upper chars,</li>
<li>deal with stick tables.</li>
</ul>
</dd></dl>

</div>
<div class="section" id="channel-class">
<span id="id7"></span><h1>Channel class<a class="headerlink" href="#channel-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Channel">
<em class="property">class </em><code class="descname">Channel</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Channel" title="Permalink to this definition">¶</a></dt>
<dd><p>HAProxy uses two buffers for the processing of the requests. The first one is
used with the request data (from the client to the server) and the second is
used for the response data (from the server to the client).</p>
<p>Each buffer contains two types of data. The first type is the incoming data
waiting for a processing. The second part is the outgoing data already
processed. Usually, the incoming data is processed, after it is tagged as
outgoing data, and finally it is sent. The following functions provides tools
for manipulating these data in a buffer.</p>
<p>The following diagram shows where the channel class function are applied.</p>
<p><strong>Warning</strong>: It is not possible to read from the response in request action,
and it is not possible to read for the request channel in response action.</p>
</dd></dl>

<img alt="_images/channel.png" src="_images/channel.png" />
<dl class="function">
<dt id="Channel.dup">
<code class="descclassname">Channel.</code><code class="descname">dup</code><span class="sig-paren">(</span><em>channel</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.dup" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns a string that contain the entire buffer. The data is
not remove from the buffer and can be reprocessed later.</p>
<p>If the buffer cant receive more data, a ‘nil’ value is returned.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing all the available data or nil.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.get">
<code class="descclassname">Channel.</code><code class="descname">get</code><span class="sig-paren">(</span><em>channel</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.get" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns a string that contain the entire buffer. The data is
consumed from the buffer.</p>
<p>If the buffer cant receive more data, a ‘nil’ value is returned.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing all the available data or nil.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.getline">
<code class="descclassname">Channel.</code><code class="descname">getline</code><span class="sig-paren">(</span><em>channel</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.getline" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns a string that contain the first line of the buffer. The
data is consumed. If the data returned doesn’t contains a final ‘n’ its
assumed than its the last available data in the buffer.</p>
<p>If the buffer cant receive more data, a ‘nil’ value is returned.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing the available line or nil.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.set">
<code class="descclassname">Channel.</code><code class="descname">set</code><span class="sig-paren">(</span><em>channel</em>, <em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.set" title="Permalink to this definition">¶</a></dt>
<dd><p>This function replace the content of the buffer by the string. The function
returns the copied length, otherwise, it returns -1.</p>
<p>The data set with this function are not send. They wait for the end of
HAProxy processing, so the buffer can be full.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
<li><strong>string</strong> (<em>string</em>) – The data which will sent.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an integer containing the amount of bytes copied or -1.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.append">
<code class="descclassname">Channel.</code><code class="descname">append</code><span class="sig-paren">(</span><em>channel</em>, <em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.append" title="Permalink to this definition">¶</a></dt>
<dd><p>This function append the string argument to the content of the buffer. The
function returns the copied length, otherwise, it returns -1.</p>
<p>The data set with this function are not send. They wait for the end of
HAProxy processing, so the buffer can be full.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
<li><strong>string</strong> (<em>string</em>) – The data which will sent.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an integer containing the amount of bytes copied or -1.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.send">
<code class="descclassname">Channel.</code><code class="descname">send</code><span class="sig-paren">(</span><em>channel</em>, <em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.send" title="Permalink to this definition">¶</a></dt>
<dd><p>This function required immediate send of the data. Unless if the connection
is close, the buffer is regularly flushed and all the string can be sent.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
<li><strong>string</strong> (<em>string</em>) – The data which will sent.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an integer containing the amount of bytes copied or -1.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.get_in_length">
<code class="descclassname">Channel.</code><code class="descname">get_in_length</code><span class="sig-paren">(</span><em>channel</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.get_in_length" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns the length of the input part of the buffer.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an integer containing the amount of available bytes.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.get_out_length">
<code class="descclassname">Channel.</code><code class="descname">get_out_length</code><span class="sig-paren">(</span><em>channel</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.get_out_length" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns the length of the output part of the buffer.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">an integer containing the amount of available bytes.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.forward">
<code class="descclassname">Channel.</code><code class="descname">forward</code><span class="sig-paren">(</span><em>channel</em>, <em>int</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>This function transfer bytes from the input part of the buffer to the output
part.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>channel</strong> (<em>class_channel</em>) – The manipulated Channel.</li>
<li><strong>int</strong> (<em>integer</em>) – The amount of data which will be forwarded.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Channel.is_full">
<code class="descclassname">Channel.</code><code class="descname">is_full</code><span class="sig-paren">(</span><em>channel</em><span class="sig-paren">)</span><a class="headerlink" href="#Channel.is_full" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns true if the buffer channel is full.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a boolean</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="http-class">
<span id="id8"></span><h1>HTTP class<a class="headerlink" href="#http-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="HTTP">
<em class="property">class </em><code class="descname">HTTP</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#HTTP" title="Permalink to this definition">¶</a></dt>
<dd><p>This class contain all the HTTP manipulation functions.</p>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_get_headers">
<code class="descclassname">HTTP.</code><code class="descname">req_get_headers</code><span class="sig-paren">(</span><em>http</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_get_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a table containing all the request headers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">table of headers.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.res_get_headers" title="HTTP.res_get_headers"><code class="xref js js-func docutils literal"><span class="pre">HTTP.res_get_headers()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>This is the form of the returned table:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="p">:</span><span class="n">req_get_headers</span><span class="p">()[</span><span class="s1">&#39;&lt;header-name&gt;&#39;</span><span class="p">][</span><span class="o">&lt;</span><span class="n">header</span><span class="o">-</span><span class="n">index</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;header-value&gt;&quot;</span>

<span class="kd">local</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">HTTP</span><span class="p">:</span><span class="n">req_get_headers</span><span class="p">()</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;www.test.com&quot;</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;audio/basic q=1&quot;</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;audio/*, q=0.2&quot;</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*/*, q=0.1&quot;</span>
</pre></div>
</div>
<dl class="function">
<dt id="HTTP.res_get_headers">
<code class="descclassname">HTTP.</code><code class="descname">res_get_headers</code><span class="sig-paren">(</span><em>http</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.res_get_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a table containing all the response headers.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">table of headers.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.req_get_headers" title="HTTP.req_get_headers"><code class="xref js js-func docutils literal"><span class="pre">HTTP.req_get_headers()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>This is the form of the returned table:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="p">:</span><span class="n">res_get_headers</span><span class="p">()[</span><span class="s1">&#39;&lt;header-name&gt;&#39;</span><span class="p">][</span><span class="o">&lt;</span><span class="n">header</span><span class="o">-</span><span class="n">index</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;header-value&gt;&quot;</span>

<span class="kd">local</span> <span class="n">hdr</span> <span class="o">=</span> <span class="n">HTTP</span><span class="p">:</span><span class="n">req_get_headers</span><span class="p">()</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;www.test.com&quot;</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;audio/basic q=1&quot;</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;audio/*, q=0.2&quot;</span>
<span class="n">hdr</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*.*, q=0.1&quot;</span>
</pre></div>
</div>
<dl class="function">
<dt id="HTTP.req_add_header">
<code class="descclassname">HTTP.</code><code class="descname">req_add_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_add_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Appends an HTTP header field in the request whose name is
specified in “name” and whose value is defined in “value”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
<li><strong>value</strong> (<em>string</em>) – The header value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.res_add_header" title="HTTP.res_add_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.res_add_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.res_add_header">
<code class="descclassname">HTTP.</code><code class="descname">res_add_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.res_add_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Appends an HTTP header field in the response whose name is
specified in “name” and whose value is defined in “value”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
<li><strong>value</strong> (<em>string</em>) – The header value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.req_add_header" title="HTTP.req_add_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.req_add_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_del_header">
<code class="descclassname">HTTP.</code><code class="descname">req_del_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_del_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all HTTP header fields in the request whose name is
specified in “name”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.res_del_header" title="HTTP.res_del_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.res_del_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.res_del_header">
<code class="descclassname">HTTP.</code><code class="descname">res_del_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.res_del_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all HTTP header fields in the response whose name is
specified in “name”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.req_del_header" title="HTTP.req_del_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.req_del_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_set_header">
<code class="descclassname">HTTP.</code><code class="descname">req_set_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_set_header" title="Permalink to this definition">¶</a></dt>
<dd><p>This variable replace all occurrence of all header “name”, by only
one containing the “value”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
<li><strong>value</strong> (<em>string</em>) – The header value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.res_set_header" title="HTTP.res_set_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.res_set_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>This function does the same work as the following code:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">fcn</span><span class="p">(</span><span class="n">txn</span><span class="p">)</span>
   <span class="n">TXN</span><span class="p">.</span><span class="n">http</span><span class="p">:</span><span class="n">req_del_header</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">)</span>
   <span class="n">TXN</span><span class="p">.</span><span class="n">http</span><span class="p">:</span><span class="n">req_add_header</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="HTTP.res_set_header">
<code class="descclassname">HTTP.</code><code class="descname">res_set_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.res_set_header" title="Permalink to this definition">¶</a></dt>
<dd><p>This variable replace all occurrence of all header “name”, by only
one containing the “value”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
<li><strong>value</strong> (<em>string</em>) – The header value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.req_rep_header" title="HTTP.req_rep_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.req_rep_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_rep_header">
<code class="descclassname">HTTP.</code><code class="descname">req_rep_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em>, <em>regex</em>, <em>replace</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_rep_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Matches the regular expression in all occurrences of header field “name”
according to “regex”, and replaces them with the “replace” argument. The
replacement value can contain back references like 1, 2, … This
function works with the request.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
<li><strong>regex</strong> (<em>string</em>) – The match regular expression.</li>
<li><strong>replace</strong> (<em>string</em>) – The replacement value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.res_rep_header" title="HTTP.res_rep_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.res_rep_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.res_rep_header">
<code class="descclassname">HTTP.</code><code class="descname">res_rep_header</code><span class="sig-paren">(</span><em>http</em>, <em>name</em>, <em>regex</em>, <em>string</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.res_rep_header" title="Permalink to this definition">¶</a></dt>
<dd><p>Matches the regular expression in all occurrences of header field “name”
according to “regex”, and replaces them with the “replace” argument. The
replacement value can contain back references like 1, 2, … This
function works with the request.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>name</strong> (<em>string</em>) – The header name.</li>
<li><strong>regex</strong> (<em>string</em>) – The match regular expression.</li>
<li><strong>replace</strong> (<em>string</em>) – The replacement value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#HTTP.req_rep_header" title="HTTP.req_rep_header"><code class="xref js js-func docutils literal"><span class="pre">HTTP.req_rep_header()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_set_method">
<code class="descclassname">HTTP.</code><code class="descname">req_set_method</code><span class="sig-paren">(</span><em>http</em>, <em>method</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_set_method" title="Permalink to this definition">¶</a></dt>
<dd><p>Rewrites the request method with the parameter “method”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>method</strong> (<em>string</em>) – The new method.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_set_path">
<code class="descclassname">HTTP.</code><code class="descname">req_set_path</code><span class="sig-paren">(</span><em>http</em>, <em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_set_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Rewrites the request path with the “path” parameter.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>path</strong> (<em>string</em>) – The new path.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_set_query">
<code class="descclassname">HTTP.</code><code class="descname">req_set_query</code><span class="sig-paren">(</span><em>http</em>, <em>query</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_set_query" title="Permalink to this definition">¶</a></dt>
<dd><p>Rewrites the request’s query string which appears after the first question
mark (“?”) with the parameter “query”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>query</strong> (<em>string</em>) – The new query.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.req_set_uri">
<code class="descclassname">HTTP.</code><code class="descname">req_set_uri</code><span class="sig-paren">(</span><em>http</em>, <em>uri</em><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.req_set_uri" title="Permalink to this definition">¶</a></dt>
<dd><p>Rewrites the request URI with the parameter “uri”.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>uri</strong> (<em>string</em>) – The new uri.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="HTTP.res_set_status">
<code class="descclassname">HTTP.</code><code class="descname">res_set_status</code><span class="sig-paren">(</span><em>http</em>, <em>status</em><span class="optional">[</span>, <em>reason</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#HTTP.res_set_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Rewrites the response status code with the parameter “code”.</p>
<p>If no custom reason is provided, it will be generated from the status.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>http</strong> (<em>class_http</em>) – The related http object.</li>
<li><strong>status</strong> (<em>integer</em>) – The new response status code.</li>
<li><strong>reason</strong> (<em>string</em>) – The new response reason (optional).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="txn-class">
<span id="id9"></span><h1>TXN class<a class="headerlink" href="#txn-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="TXN">
<em class="property">class </em><code class="descname">TXN</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#TXN" title="Permalink to this definition">¶</a></dt>
<dd><p>The txn class contain all the functions relative to the http or tcp
transaction (Note than a tcp stream is the same than a tcp transaction, but
an HTTP transaction is not the same than a tcp stream).</p>
<p>The usage of this class permits to retrieve data from the requests, alter it
and forward it.</p>
<p>All the functions provided by this class are available in the context
<strong>sample-fetches</strong> and <strong>actions</strong>.</p>
</dd></dl>

<dl class="attribute">
<dt id="TXN.c">
<code class="descclassname">TXN.</code><code class="descname">c</code><a class="headerlink" href="#TXN.c" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An <a class="reference internal" href="#converters-class"><span class="std std-ref">Converters class</span></a>.</td>
</tr>
</tbody>
</table>
<p>This attribute contains a Converters class object.</p>
</dd></dl>

<dl class="attribute">
<dt id="TXN.sc">
<code class="descclassname">TXN.</code><code class="descname">sc</code><a class="headerlink" href="#TXN.sc" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An <a class="reference internal" href="#converters-class"><span class="std std-ref">Converters class</span></a>.</td>
</tr>
</tbody>
</table>
<p>This attribute contains a Converters class object. The functions of
this object returns always a string.</p>
</dd></dl>

<dl class="attribute">
<dt id="TXN.f">
<code class="descclassname">TXN.</code><code class="descname">f</code><a class="headerlink" href="#TXN.f" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An <a class="reference internal" href="#fetches-class"><span class="std std-ref">Fetches class</span></a>.</td>
</tr>
</tbody>
</table>
<p>This attribute contains a Fetches class object.</p>
</dd></dl>

<dl class="attribute">
<dt id="TXN.sf">
<code class="descclassname">TXN.</code><code class="descname">sf</code><a class="headerlink" href="#TXN.sf" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An <a class="reference internal" href="#fetches-class"><span class="std std-ref">Fetches class</span></a>.</td>
</tr>
</tbody>
</table>
<p>This attribute contains a Fetches class object. The functions of
this object returns always a string.</p>
</dd></dl>

<dl class="attribute">
<dt id="TXN.req">
<code class="descclassname">TXN.</code><code class="descname">req</code><a class="headerlink" href="#TXN.req" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An <a class="reference internal" href="#channel-class"><span class="std std-ref">Channel class</span></a>.</td>
</tr>
</tbody>
</table>
<p>This attribute contains a channel class object for the request buffer.</p>
</dd></dl>

<dl class="attribute">
<dt id="TXN.res">
<code class="descclassname">TXN.</code><code class="descname">res</code><a class="headerlink" href="#TXN.res" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An <a class="reference internal" href="#channel-class"><span class="std std-ref">Channel class</span></a>.</td>
</tr>
</tbody>
</table>
<p>This attribute contains a channel class object for the response buffer.</p>
</dd></dl>

<dl class="attribute">
<dt id="TXN.http">
<code class="descclassname">TXN.</code><code class="descname">http</code><a class="headerlink" href="#TXN.http" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">An <a class="reference internal" href="#http-class"><span class="std std-ref">HTTP class</span></a>.</td>
</tr>
</tbody>
</table>
<p>This attribute contains an HTTP class object. It is available only if the
proxy has the “mode http” enabled.</p>
</dd></dl>

<dl class="function">
<dt id="TXN.log">
<code class="descclassname">TXN.</code><code class="descname">log</code><span class="sig-paren">(</span><em>TXN</em>, <em>loglevel</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.log" title="Permalink to this definition">¶</a></dt>
<dd><p>This function sends a log. The log is sent, according with the HAProxy
configuration file, on the default syslog server if it is configured and on
the stderr if it is allowed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>loglevel</strong> (<em>integer</em>) – Is the log level associated with the message. It is a
number between 0 and 7.</li>
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#core.emerg" title="core.emerg"><code class="xref js js-attr docutils literal"><span class="pre">core.emerg</span></code></a>, <a class="reference internal" href="#core.alert" title="core.alert"><code class="xref js js-attr docutils literal"><span class="pre">core.alert</span></code></a>, <a class="reference internal" href="#core.crit" title="core.crit"><code class="xref js js-attr docutils literal"><span class="pre">core.crit</span></code></a>,
<a class="reference internal" href="#core.err" title="core.err"><code class="xref js js-attr docutils literal"><span class="pre">core.err</span></code></a>, <a class="reference internal" href="#core.warning" title="core.warning"><code class="xref js js-attr docutils literal"><span class="pre">core.warning</span></code></a>, <a class="reference internal" href="#core.notice" title="core.notice"><code class="xref js js-attr docutils literal"><span class="pre">core.notice</span></code></a>,
<a class="reference internal" href="#core.info" title="core.info"><code class="xref js js-attr docutils literal"><span class="pre">core.info</span></code></a>, <a class="reference internal" href="#core.debug" title="core.debug"><code class="xref js js-attr docutils literal"><span class="pre">core.debug</span></code></a> (log level definitions)</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#TXN.deflog" title="TXN.deflog"><code class="xref js js-func docutils literal"><span class="pre">TXN.deflog()</span></code></a></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#TXN.Debug" title="TXN.Debug"><code class="xref js js-func docutils literal"><span class="pre">TXN.Debug()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#TXN.Info" title="TXN.Info"><code class="xref js js-func docutils literal"><span class="pre">TXN.Info()</span></code></a></p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#TXN.Warning" title="TXN.Warning"><code class="xref js js-func docutils literal"><span class="pre">TXN.Warning()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#TXN.Alert" title="TXN.Alert"><code class="xref js js-func docutils literal"><span class="pre">TXN.Alert()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.deflog">
<code class="descclassname">TXN.</code><code class="descname">deflog</code><span class="sig-paren">(</span><em>TXN</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.deflog" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends a log line with the default loglevel for the proxy associated with the
transaction.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last">:js:func:<a href="#id10"><span class="problematic" id="id11">`</span></a>TXN.log</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.Debug">
<code class="descclassname">TXN.</code><code class="descname">Debug</code><span class="sig-paren">(</span><em>txn</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.Debug" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#TXN.log" title="TXN.log"><code class="xref js js-func docutils literal"><span class="pre">TXN.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Does the same job than:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Debug</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="n">TXN</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">core</span><span class="p">.</span><span class="n">debug</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="TXN.Info">
<code class="descclassname">TXN.</code><code class="descname">Info</code><span class="sig-paren">(</span><em>txn</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.Info" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#TXN.log" title="TXN.log"><code class="xref js js-func docutils literal"><span class="pre">TXN.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Debug</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="n">TXN</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">core</span><span class="p">.</span><span class="n">info</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="TXN.Warning">
<code class="descclassname">TXN.</code><code class="descname">Warning</code><span class="sig-paren">(</span><em>txn</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.Warning" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#TXN.log" title="TXN.log"><code class="xref js js-func docutils literal"><span class="pre">TXN.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Debug</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="n">TXN</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">core</span><span class="p">.</span><span class="n">warning</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="TXN.Alert">
<code class="descclassname">TXN.</code><code class="descname">Alert</code><span class="sig-paren">(</span><em>txn</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.Alert" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>msg</strong> (<em>string</em>) – The log content.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#TXN.log" title="TXN.log"><code class="xref js js-func docutils literal"><span class="pre">TXN.log()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kr">function</span> <span class="nf">Debug</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
  <span class="n">TXN</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">txn</span><span class="p">,</span> <span class="n">core</span><span class="p">.</span><span class="n">alert</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
<span class="kr">end</span>
</pre></div>
</div>
<dl class="function">
<dt id="TXN.get_priv">
<code class="descclassname">TXN.</code><code class="descname">get_priv</code><span class="sig-paren">(</span><em>txn</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.get_priv" title="Permalink to this definition">¶</a></dt>
<dd><p>Return Lua data stored in the current transaction (with the <cite>TXN.set_priv()</cite>)
function. If no data are stored, it returns a nil value.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the opaque data previously stored, or nil if nothing is
available.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.set_priv">
<code class="descclassname">TXN.</code><code class="descname">set_priv</code><span class="sig-paren">(</span><em>txn</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.set_priv" title="Permalink to this definition">¶</a></dt>
<dd><p>Store any data in the current HAProxy transaction. This action replace the
old stored data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>data</strong> (<em>opaque</em>) – The data which is stored in the transaction.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.set_var">
<code class="descclassname">TXN.</code><code class="descname">set_var</code><span class="sig-paren">(</span><em>TXN</em>, <em>var</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.set_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a Lua type in a HAProxy type and store it in a variable &lt;var&gt;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
<li><strong>value</strong> (<em>type</em>) – The value associated to the variable. The type can be string or
integer.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.unset_var">
<code class="descclassname">TXN.</code><code class="descname">unset_var</code><span class="sig-paren">(</span><em>TXN</em>, <em>var</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.unset_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Unset the variable &lt;var&gt;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.get_var">
<code class="descclassname">TXN.</code><code class="descname">get_var</code><span class="sig-paren">(</span><em>TXN</em>, <em>var</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.get_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns data stored in the variable &lt;var&gt; converter in Lua type.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.done">
<code class="descclassname">TXN.</code><code class="descname">done</code><span class="sig-paren">(</span><em>txn</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.done" title="Permalink to this definition">¶</a></dt>
<dd><p>This function terminates processing of the transaction and the associated
session. It can be used when a critical error is detected or to terminate
processing after some data have been returned to the client (eg: a redirect).</p>
<p><em>Warning</em>: It not make sense to call this function from sample-fetches. In
this case the behaviour of this one is the same than core.done(): it quit
the Lua execution. The transaction is really aborted only from an action
registered function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.set_loglevel">
<code class="descclassname">TXN.</code><code class="descname">set_loglevel</code><span class="sig-paren">(</span><em>txn</em>, <em>loglevel</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.set_loglevel" title="Permalink to this definition">¶</a></dt>
<dd><p>Is used to change the log level of the current request. The “loglevel” must
be an integer between 0 and 7.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>loglevel</strong> (<em>integer</em>) – The required log level. This variable can be one of</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#core.emerg" title="core.emerg"><code class="xref js js-attr docutils literal"><span class="pre">core.emerg</span></code></a>, <a class="reference internal" href="#core.alert" title="core.alert"><code class="xref js js-attr docutils literal"><span class="pre">core.alert</span></code></a>, <a class="reference internal" href="#core.crit" title="core.crit"><code class="xref js js-attr docutils literal"><span class="pre">core.crit</span></code></a>,
<a class="reference internal" href="#core.err" title="core.err"><code class="xref js js-attr docutils literal"><span class="pre">core.err</span></code></a>, <a class="reference internal" href="#core.warning" title="core.warning"><code class="xref js js-attr docutils literal"><span class="pre">core.warning</span></code></a>, <a class="reference internal" href="#core.notice" title="core.notice"><code class="xref js js-attr docutils literal"><span class="pre">core.notice</span></code></a>,
<a class="reference internal" href="#core.info" title="core.info"><code class="xref js js-attr docutils literal"><span class="pre">core.info</span></code></a>, <a class="reference internal" href="#core.debug" title="core.debug"><code class="xref js js-attr docutils literal"><span class="pre">core.debug</span></code></a> (log level definitions)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.set_tos">
<code class="descclassname">TXN.</code><code class="descname">set_tos</code><span class="sig-paren">(</span><em>txn</em>, <em>tos</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.set_tos" title="Permalink to this definition">¶</a></dt>
<dd><p>Is used to set the TOS or DSCP field value of packets sent to the client to
the value passed in “tos” on platforms which support this.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>tos</strong> (<em>integer</em>) – The new TOS os DSCP.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.set_mark">
<code class="descclassname">TXN.</code><code class="descname">set_mark</code><span class="sig-paren">(</span><em>txn</em>, <em>mark</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.set_mark" title="Permalink to this definition">¶</a></dt>
<dd><p>Is used to set the Netfilter MARK on all packets sent to the client to the
value passed in “mark” on platforms which support it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>txn</strong> (<em>class_txn</em>) – The class txn object containing the data.</li>
<li><strong>mark</strong> (<em>integer</em>) – The mark value.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="TXN.set_priority_class">
<code class="descclassname">TXN.</code><code class="descname">set_priority_class</code><span class="sig-paren">(</span><em>txn</em>, <em>prio</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.set_priority_class" title="Permalink to this definition">¶</a></dt>
<dd><p>This function adjusts the priority class of the transaction. The value should
be within the range -2047..2047. Values outside this range will be
truncated.</p>
<p>See the HAProxy configuration.txt file keyword “http-request” action
“set-priority-class” for details.</p>
</dd></dl>

<dl class="function">
<dt id="TXN.set_priority_offset">
<code class="descclassname">TXN.</code><code class="descname">set_priority_offset</code><span class="sig-paren">(</span><em>txn</em>, <em>prio</em><span class="sig-paren">)</span><a class="headerlink" href="#TXN.set_priority_offset" title="Permalink to this definition">¶</a></dt>
<dd><p>This function adjusts the priority offset of the transaction. The value
should be within the range -524287..524287. Values outside this range will be
truncated.</p>
<p>See the HAProxy configuration.txt file keyword “http-request” action
“set-priority-offset” for details.</p>
</dd></dl>

</div>
<div class="section" id="socket-class">
<span id="id12"></span><h1>Socket class<a class="headerlink" href="#socket-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Socket">
<em class="property">class </em><code class="descname">Socket</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Socket" title="Permalink to this definition">¶</a></dt>
<dd><p>This class must be compatible with the Lua Socket class. Only the ‘client’
functions are available. See the Lua Socket documentation:</p>
<p><a class="reference external" href="http://w3.impa.br/~diego/software/luasocket/tcp.html">http://w3.impa.br/~diego/software/luasocket/tcp.html</a></p>
</dd></dl>

<dl class="function">
<dt id="Socket.close">
<code class="descclassname">Socket.</code><code class="descname">close</code><span class="sig-paren">(</span><em>socket</em><span class="sig-paren">)</span><a class="headerlink" href="#Socket.close" title="Permalink to this definition">¶</a></dt>
<dd><p>Closes a TCP object. The internal socket used by the object is closed and the
local address to which the object was bound is made available to other
applications. No further operations (except for further calls to the close
method) are allowed on a closed Socket.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Note: It is important to close all used sockets once they are not needed,
since, in many systems, each socket uses a file descriptor, which are limited
system resources. Garbage-collected objects are automatically closed before
destruction, though.</p>
</dd></dl>

<dl class="function">
<dt id="Socket.connect">
<code class="descclassname">Socket.</code><code class="descname">connect</code><span class="sig-paren">(</span><em>socket</em>, <em>address</em><span class="optional">[</span>, <em>port</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Socket.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Attempts to connect a socket object to a remote host.</p>
<p>In case of error, the method returns nil followed by a string describing the
error. In case of success, the method returns 1.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
<li><strong>address</strong> (<em>string</em>) – can be an IP address or a host name. See below for more
information.</li>
<li><strong>port</strong> (<em>integer</em>) – must be an integer number in the range [1..64K].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">1 or nil.</p>
</td>
</tr>
</tbody>
</table>
<p>An address field extension permits to use the connect() function to connect to
other stream than TCP. The syntax containing a simpleipv4 or ipv6 address is
the basically expected format. This format requires the port.</p>
<p>Other format accepted are a socket path like “/socket/path”, it permits to
connect to a socket. Abstract namespaces are supported with the prefix
“abns&#64;”, and finally a file descriptor can be passed with the prefix “fd&#64;”.
The prefix “ipv4&#64;”, “ipv6&#64;” and “unix&#64;” are also supported. The port can be
passed int the string. The syntax “127.0.0.1:1234” is valid. In this case, the
parameter <em>port</em> must not be set.</p>
</dd></dl>

<dl class="function">
<dt id="Socket.connect_ssl">
<code class="descclassname">Socket.</code><code class="descname">connect_ssl</code><span class="sig-paren">(</span><em>socket</em>, <em>address</em>, <em>port</em><span class="sig-paren">)</span><a class="headerlink" href="#Socket.connect_ssl" title="Permalink to this definition">¶</a></dt>
<dd><p>Same behavior than the function socket:connect, but uses SSL.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">1 or nil.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Socket.getpeername">
<code class="descclassname">Socket.</code><code class="descname">getpeername</code><span class="sig-paren">(</span><em>socket</em><span class="sig-paren">)</span><a class="headerlink" href="#Socket.getpeername" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns information about the remote side of a connected client object.</p>
<p>Returns a string with the IP address of the peer, followed by the port number
that peer is using for the connection. In case of error, the method returns
nil.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing the server information.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Socket.getsockname">
<code class="descclassname">Socket.</code><code class="descname">getsockname</code><span class="sig-paren">(</span><em>socket</em><span class="sig-paren">)</span><a class="headerlink" href="#Socket.getsockname" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the local address information associated to the object.</p>
<p>The method returns a string with local IP address and a number with the port.
In case of error, the method returns nil.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing the client information.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Socket.receive">
<code class="descclassname">Socket.</code><code class="descname">receive</code><span class="sig-paren">(</span><em>socket</em><span class="optional">[</span>, <em>pattern</em><span class="optional">[</span>, <em>prefix</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Socket.receive" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads data from a client object, according to the specified read pattern.
Patterns follow the Lua file I/O format, and the difference in performance
between all patterns is negligible.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
<li><strong>pattern</strong> (<em>string|integer</em>) – Describe what is required (see below).</li>
<li><strong>prefix</strong> (<em>string</em>) – A string which will be prefix the returned data.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing the required data or nil.</p>
</td>
</tr>
</tbody>
</table>
<p>Pattern can be any of the following:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><strong>`*a`</strong>: reads from the socket until the connection is closed. No</dt>
<dd>end-of-line translation is performed;</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>`*l`</strong>: reads a line of text from the Socket. The line is terminated by a</dt>
<dd>LF character (ASCII 10), optionally preceded by a CR character
(ASCII 13). The CR and LF characters are not included in the
returned line.  In fact, all CR characters are ignored by the
pattern. This is the default pattern.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>number</strong>: causes the method to read a specified number of bytes from the</dt>
<dd>Socket. Prefix is an optional string to be concatenated to the
beginning of any received data before return.</dd>
</dl>
</li>
<li><strong>empty</strong>: If the pattern is left empty, the default option is <cite>*l</cite>.</li>
</ul>
<p>If successful, the method returns the received pattern. In case of error, the
method returns nil followed by an error message which can be the string
‘closed’ in case the connection was closed before the transmission was
completed or the string ‘timeout’ in case there was a timeout during the
operation. Also, after the error message, the function returns the partial
result of the transmission.</p>
<p>Important note: This function was changed severely. It used to support
multiple patterns (but I have never seen this feature used) and now it
doesn’t anymore.  Partial results used to be returned in the same way as
successful results. This last feature violated the idea that all functions
should return nil on error.  Thus it was changed too.</p>
</dd></dl>

<dl class="function">
<dt id="Socket.send">
<code class="descclassname">Socket.</code><code class="descname">send</code><span class="sig-paren">(</span><em>socket</em>, <em>data</em><span class="optional">[</span>, <em>start</em><span class="optional">[</span>, <em>end</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Socket.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Sends data through client object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
<li><strong>data</strong> (<em>string</em>) – The data that will be sent.</li>
<li><strong>start</strong> (<em>integer</em>) – The start position in the buffer of the data which will
be sent.</li>
<li><strong>end</strong> (<em>integer</em>) – The end position in the buffer of the data which will
be sent.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">see below.</p>
</td>
</tr>
</tbody>
</table>
<p>Data is the string to be sent. The optional arguments i and j work exactly
like the standard string.sub Lua function to allow the selection of a
substring to be sent.</p>
<p>If successful, the method returns the index of the last byte within [start,
end] that has been sent. Notice that, if start is 1 or absent, this is
effectively the total number of bytes sent. In case of error, the method
returns nil, followed by an error message, followed by the index of the last
byte within [start, end] that has been sent. You might want to try again from
the byte following that. The error message can be ‘closed’ in case the
connection was closed before the transmission was completed or the string
‘timeout’ in case there was a timeout during the operation.</p>
<p>Note: Output is not buffered. For small strings, it is always better to
concatenate them in Lua (with the ‘..’ operator) and send the result in one
call instead of calling the method several times.</p>
</dd></dl>

<dl class="function">
<dt id="Socket.setoption">
<code class="descclassname">Socket.</code><code class="descname">setoption</code><span class="sig-paren">(</span><em>socket</em>, <em>option</em><span class="optional">[</span>, <em>value</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Socket.setoption" title="Permalink to this definition">¶</a></dt>
<dd><p>Just implemented for compatibility, this cal does nothing.</p>
</dd></dl>

<dl class="function">
<dt id="Socket.settimeout">
<code class="descclassname">Socket.</code><code class="descname">settimeout</code><span class="sig-paren">(</span><em>socket</em>, <em>value</em><span class="optional">[</span>, <em>mode</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Socket.settimeout" title="Permalink to this definition">¶</a></dt>
<dd><p>Changes the timeout values for the object. All I/O operations are blocking.
That is, any call to the methods send, receive, and accept will block
indefinitely, until the operation completes. The settimeout method defines a
limit on the amount of time the I/O methods can block. When a timeout time
has elapsed, the affected methods give up and fail with an error code.</p>
<p>The amount of time to wait is specified as the value parameter, in seconds.</p>
<p>The timeout modes are not implemented, the only settable timeout is the
inactivity time waiting for complete the internal buffer send or waiting for
receive data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>socket</strong> (<em>class_socket</em>) – Is the manipulated Socket.</li>
<li><strong>value</strong> (<em>float</em>) – The timeout value. Use floating point to specify
milliseconds.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="regex-class">
<span id="id13"></span><h1>Regex class<a class="headerlink" href="#regex-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Regex">
<em class="property">class </em><code class="descname">Regex</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Regex" title="Permalink to this definition">¶</a></dt>
<dd><p>This class allows the usage of HAProxy regexes because classic lua doesn’t
provides regexes. This class inherits the HAProxy compilation options, so the
regexes can be libc regex, pcre regex or pcre JIT regex.</p>
<p>The expression matching number is limited to 20 per regex. The only available
option is case sensitive.</p>
<p>Because regexes compilation is a heavy process, it is better to define all
your regexes in the <strong>body context</strong> and use it during the runtime.</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="c1">-- Create the regex</span>
<span class="n">st</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="n">Regex</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;needle (..) (...)&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">-- Check compilation errors</span>
<span class="kr">if</span> <span class="n">st</span> <span class="o">==</span> <span class="kc">false</span> <span class="kr">then</span>
  <span class="nb">print</span> <span class="s2">&quot;error: &quot;</span> <span class="o">..</span> <span class="n">regex</span>
<span class="kr">end</span>

<span class="c1">-- Match the regexes</span>
<span class="nb">print</span><span class="p">(</span><span class="n">regex</span><span class="p">:</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;Looking for a needle in the haystack&quot;</span><span class="p">))</span> <span class="c1">-- true</span>
<span class="nb">print</span><span class="p">(</span><span class="n">regex</span><span class="p">:</span><span class="n">exec</span><span class="p">(</span><span class="s2">&quot;Lokking for a cat in the haystack&quot;</span><span class="p">))</span>    <span class="c1">-- false</span>

<span class="c1">-- Extract words</span>
<span class="n">st</span><span class="p">,</span> <span class="n">list</span> <span class="o">=</span> <span class="n">regex</span><span class="p">:</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;Looking for a needle in the haystack&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>      <span class="c1">-- true</span>
<span class="nb">print</span><span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c1">-- needle in the</span>
<span class="nb">print</span><span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">-- in</span>
<span class="nb">print</span><span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1">-- the</span>
</pre></div>
</div>
<dl class="function">
<dt id="Regex.new">
<code class="descclassname">Regex.</code><code class="descname">new</code><span class="sig-paren">(</span><em>regex</em>, <em>case_sensitive</em><span class="sig-paren">)</span><a class="headerlink" href="#Regex.new" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and compile a regex.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>regex</strong> (<em>string</em>) – The regular expression according with the libc or pcre
standard</li>
<li><strong>case_sensitive</strong> (<em>boolean</em>) – Match is case sensitive or not.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean status and <a class="reference internal" href="#regex-class"><span class="std std-ref">Regex class</span></a> or string containing fail reason.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Regex.exec">
<code class="descclassname">Regex.</code><code class="descname">exec</code><span class="sig-paren">(</span><em>regex</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#Regex.exec" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute the regex.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>regex</strong> (<em>class_regex</em>) – A <a class="reference internal" href="#regex-class"><span class="std std-ref">Regex class</span></a> object.</li>
<li><strong>str</strong> (<em>string</em>) – The input string will be compared with the compiled regex.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a boolean status according with the match result.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Regex.match">
<code class="descclassname">Regex.</code><code class="descname">match</code><span class="sig-paren">(</span><em>regex</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#Regex.match" title="Permalink to this definition">¶</a></dt>
<dd><p>Execute the regex and return matched expressions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>map</strong> (<em>class_map</em>) – A <a class="reference internal" href="#regex-class"><span class="std std-ref">Regex class</span></a> object.</li>
<li><strong>str</strong> (<em>string</em>) – The input string will be compared with the compiled regex.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a boolean status according with the match result, and
a table containing all the string matched in order of declaration.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="map-class">
<span id="id14"></span><h1>Map class<a class="headerlink" href="#map-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Map">
<em class="property">class </em><code class="descname">Map</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Map" title="Permalink to this definition">¶</a></dt>
<dd><p>This class permits to do some lookup in HAProxy maps. The declared maps can
be modified during the runtime through the HAProxy management socket.</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;usa&quot;</span>

<span class="c1">-- Create and load map</span>
<span class="n">geo</span> <span class="o">=</span> <span class="n">Map</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;geo.map&quot;</span><span class="p">,</span> <span class="n">Map</span><span class="p">.</span><span class="n">_ip</span><span class="p">);</span>

<span class="c1">-- Create new fetch that returns the user country</span>
<span class="n">core</span><span class="p">.</span><span class="n">register_fetches</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">txn</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">src</span><span class="p">;</span>
  <span class="kd">local</span> <span class="n">loc</span><span class="p">;</span>

  <span class="n">src</span> <span class="o">=</span> <span class="n">txn</span><span class="p">.</span><span class="n">f</span><span class="p">:</span><span class="n">fhdr</span><span class="p">(</span><span class="s2">&quot;x-forwarded-for&quot;</span><span class="p">);</span>
  <span class="kr">if</span> <span class="p">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="kr">then</span>
    <span class="n">src</span> <span class="o">=</span> <span class="n">txn</span><span class="p">.</span><span class="n">f</span><span class="p">:</span><span class="n">src</span><span class="p">()</span>
    <span class="kr">if</span> <span class="p">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="kr">then</span>
      <span class="kr">return</span> <span class="n">default</span><span class="p">;</span>
    <span class="kr">end</span>
  <span class="kr">end</span>

  <span class="c1">-- Perform lookup</span>
  <span class="n">loc</span> <span class="o">=</span> <span class="n">geo</span><span class="p">:</span><span class="n">lookup</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>

  <span class="kr">if</span> <span class="p">(</span><span class="n">loc</span> <span class="o">==</span> <span class="kc">nil</span><span class="p">)</span> <span class="kr">then</span>
    <span class="kr">return</span> <span class="n">default</span><span class="p">;</span>
  <span class="kr">end</span>

  <span class="kr">return</span> <span class="n">loc</span><span class="p">;</span>
<span class="kr">end</span><span class="p">);</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="Map._int">
<code class="descclassname">Map.</code><code class="descname">_int</code><a class="headerlink" href="#Map._int" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.int</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._ip">
<code class="descclassname">Map.</code><code class="descname">_ip</code><a class="headerlink" href="#Map._ip" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.ip</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._str">
<code class="descclassname">Map.</code><code class="descname">_str</code><a class="headerlink" href="#Map._str" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.str</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._beg">
<code class="descclassname">Map.</code><code class="descname">_beg</code><a class="headerlink" href="#Map._beg" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.beg</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._sub">
<code class="descclassname">Map.</code><code class="descname">_sub</code><a class="headerlink" href="#Map._sub" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.sub</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._dir">
<code class="descclassname">Map.</code><code class="descname">_dir</code><a class="headerlink" href="#Map._dir" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.dir</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._dom">
<code class="descclassname">Map.</code><code class="descname">_dom</code><a class="headerlink" href="#Map._dom" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.dom</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._end">
<code class="descclassname">Map.</code><code class="descname">_end</code><a class="headerlink" href="#Map._end" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
</dd></dl>

<dl class="attribute">
<dt id="Map._reg">
<code class="descclassname">Map.</code><code class="descname">_reg</code><a class="headerlink" href="#Map._reg" title="Permalink to this definition">¶</a></dt>
<dd><p>See the HAProxy configuration.txt file, chapter “Using ACLs and fetching
samples” ans subchapter “ACL basics” to understand this pattern matching
method.</p>
<p>Note that <code class="xref js js-attr docutils literal"><span class="pre">Map.reg</span></code> is also available for compatibility.</p>
</dd></dl>

<dl class="function">
<dt id="Map.new">
<code class="descclassname">Map.</code><code class="descname">new</code><span class="sig-paren">(</span><em>file</em>, <em>method</em><span class="sig-paren">)</span><a class="headerlink" href="#Map.new" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and load a map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>file</strong> (<em>string</em>) – Is the file containing the map.</li>
<li><strong>method</strong> (<em>integer</em>) – Is the map pattern matching method. See the attributes
of the Map class.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a class Map object.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last">The Map attributes: <a class="reference internal" href="#Map._int" title="Map._int"><code class="xref js js-attr docutils literal"><span class="pre">Map._int</span></code></a>, <a class="reference internal" href="#Map._ip" title="Map._ip"><code class="xref js js-attr docutils literal"><span class="pre">Map._ip</span></code></a>,
<a class="reference internal" href="#Map._str" title="Map._str"><code class="xref js js-attr docutils literal"><span class="pre">Map._str</span></code></a>, <a class="reference internal" href="#Map._beg" title="Map._beg"><code class="xref js js-attr docutils literal"><span class="pre">Map._beg</span></code></a>, <a class="reference internal" href="#Map._sub" title="Map._sub"><code class="xref js js-attr docutils literal"><span class="pre">Map._sub</span></code></a>,
<a class="reference internal" href="#Map._dir" title="Map._dir"><code class="xref js js-attr docutils literal"><span class="pre">Map._dir</span></code></a>, <a class="reference internal" href="#Map._dom" title="Map._dom"><code class="xref js js-attr docutils literal"><span class="pre">Map._dom</span></code></a>, <a class="reference internal" href="#Map._end" title="Map._end"><code class="xref js js-attr docutils literal"><span class="pre">Map._end</span></code></a> and
<a class="reference internal" href="#Map._reg" title="Map._reg"><code class="xref js js-attr docutils literal"><span class="pre">Map._reg</span></code></a>.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Map.lookup">
<code class="descclassname">Map.</code><code class="descname">lookup</code><span class="sig-paren">(</span><em>map</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#Map.lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a lookup in a map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>map</strong> (<em>class_map</em>) – Is the class Map object.</li>
<li><strong>str</strong> (<em>string</em>) – Is the string used as key.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing the result or nil if no match.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="Map.slookup">
<code class="descclassname">Map.</code><code class="descname">slookup</code><span class="sig-paren">(</span><em>map</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#Map.slookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a lookup in a map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>map</strong> (<em>class_map</em>) – Is the class Map object.</li>
<li><strong>str</strong> (<em>string</em>) – Is the string used as key.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string containing the result or empty string if no match.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="applethttp-class">
<span id="id15"></span><h1>AppletHTTP class<a class="headerlink" href="#applethttp-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="AppletHTTP">
<em class="property">class </em><code class="descname">AppletHTTP</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is used with applets that requires the ‘http’ mode. The http applet
can be registered with the <em>core.register_service()</em> function. They are used
for processing an http request like a server in back of HAProxy.</p>
<p>This is an hello world sample code:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">core</span><span class="p">.</span><span class="n">register_service</span><span class="p">(</span><span class="s2">&quot;hello-world&quot;</span><span class="p">,</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span><span class="n">applet</span><span class="p">)</span>
   <span class="kd">local</span> <span class="n">response</span> <span class="o">=</span> <span class="s2">&quot;Hello World !&quot;</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">set_status</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;content-length&quot;</span><span class="p">,</span> <span class="nb">string.len</span><span class="p">(</span><span class="n">response</span><span class="p">))</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">add_header</span><span class="p">(</span><span class="s2">&quot;content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">start_response</span><span class="p">()</span>
   <span class="n">applet</span><span class="p">:</span><span class="n">send</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="kr">end</span><span class="p">)</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="AppletHTTP.c">
<code class="descclassname">AppletHTTP.</code><code class="descname">c</code><a class="headerlink" href="#AppletHTTP.c" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#converters-class"><span class="std std-ref">Converters class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Converters class object.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.sc">
<code class="descclassname">AppletHTTP.</code><code class="descname">sc</code><a class="headerlink" href="#AppletHTTP.sc" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#converters-class"><span class="std std-ref">Converters class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Converters class object. The
functions of this object returns always a string.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.f">
<code class="descclassname">AppletHTTP.</code><code class="descname">f</code><a class="headerlink" href="#AppletHTTP.f" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#fetches-class"><span class="std std-ref">Fetches class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Fetches class object. Note that the
applet execution place cannot access to a valid HAProxy core HTTP
transaction, so some sample fetches related to the HTTP dependant
values (hdr, path, …) are not available.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.sf">
<code class="descclassname">AppletHTTP.</code><code class="descname">sf</code><a class="headerlink" href="#AppletHTTP.sf" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#fetches-class"><span class="std std-ref">Fetches class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Fetches class object. The functions of
this object returns always a string. Note that the applet
execution place cannot access to a valid HAProxy core HTTP
transaction, so some sample fetches related to the HTTP dependant
values (hdr, path, …) are not available.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.method">
<code class="descclassname">AppletHTTP.</code><code class="descname">method</code><a class="headerlink" href="#AppletHTTP.method" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>The attribute method returns a string containing the HTTP
method.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.version">
<code class="descclassname">AppletHTTP.</code><code class="descname">version</code><a class="headerlink" href="#AppletHTTP.version" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>The attribute version, returns a string containing the HTTP
request version.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.path">
<code class="descclassname">AppletHTTP.</code><code class="descname">path</code><a class="headerlink" href="#AppletHTTP.path" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>The attribute path returns a string containing the HTTP
request path.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.qs">
<code class="descclassname">AppletHTTP.</code><code class="descname">qs</code><a class="headerlink" href="#AppletHTTP.qs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>The attribute qs returns a string containing the HTTP
request query string.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.length">
<code class="descclassname">AppletHTTP.</code><code class="descname">length</code><a class="headerlink" href="#AppletHTTP.length" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>The attribute length returns an integer containing the HTTP
body length.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletHTTP.headers">
<code class="descclassname">AppletHTTP.</code><code class="descname">headers</code><a class="headerlink" href="#AppletHTTP.headers" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">table</td>
</tr>
</tbody>
</table>
<p>The attribute headers returns a table containing the HTTP
headers. The header names are always in lower case. As the header name can be
encountered more than once in each request, the value is indexed with 0 as
first index value. The table have this form:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">AppletHTTP</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;&lt;header-name&gt;&#39;</span><span class="p">][</span><span class="o">&lt;</span><span class="n">header</span><span class="o">-</span><span class="n">index</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&lt;header-value&gt;&quot;</span>

<span class="n">AppletHTTP</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;www.test.com&quot;</span>
<span class="n">AppletHTTP</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;audio/basic q=1&quot;</span>
<span class="n">AppletHTTP</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;audio/*, q=0.2&quot;</span>
<span class="n">AppletHTTP</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;accept&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*/*, q=0.1&quot;</span>
</pre></div>
</div>
<dl class="function">
<dt id="AppletHTTP.set_status">
<code class="descclassname">AppletHTTP.</code><code class="descname">set_status</code><span class="sig-paren">(</span><em>applet</em>, <em>code</em><span class="optional">[</span>, <em>reason</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.set_status" title="Permalink to this definition">¶</a></dt>
<dd><p>This function sets the HTTP status code for the response. The allowed code are
from 100 to 599.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>code</strong> (<em>integer</em>) – the status code returned to the client.</li>
<li><strong>reason</strong> (<em>string</em>) – the status reason returned to the client (optional).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.add_header">
<code class="descclassname">AppletHTTP.</code><code class="descname">add_header</code><span class="sig-paren">(</span><em>applet</em>, <em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.add_header" title="Permalink to this definition">¶</a></dt>
<dd><p>This function add an header in the response. Duplicated headers are not
collapsed. The special header <em>content-length</em> is used to determinate the
response length. If it not exists, a <em>transfer-encoding: chunked</em> is set, and
all the write from the funcion <em>AppletHTTP:send()</em> become a chunk.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>name</strong> (<em>string</em>) – the header name</li>
<li><strong>value</strong> (<em>string</em>) – the header value</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.start_response">
<code class="descclassname">AppletHTTP.</code><code class="descname">start_response</code><span class="sig-paren">(</span><em>applet</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.start_response" title="Permalink to this definition">¶</a></dt>
<dd><p>This function indicates to the HTTP engine that it can process and send the
response headers. After this called we cannot add headers to the response; We
cannot use the <em>AppletHTTP:send()</em> function if the
<em>AppletHTTP:start_response()</em> is not called.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.getline">
<code class="descclassname">AppletHTTP.</code><code class="descname">getline</code><span class="sig-paren">(</span><em>applet</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.getline" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns a string containing one line from the http body. If the
data returned doesn’t contains a final ‘\n’ its assumed than its the last
available data before the end of stream.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string. The string can be empty if we reach the end of the stream.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.receive">
<code class="descclassname">AppletHTTP.</code><code class="descname">receive</code><span class="sig-paren">(</span><em>applet</em><span class="optional">[</span>, <em>size</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.receive" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads data from the HTTP body, according to the specified read <em>size</em>. If the
<em>size</em> is missing, the function tries to read all the content of the stream
until the end. If the <em>size</em> is bigger than the http body, it returns the
amount of data available.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>size</strong> (<em>integer</em>) – the required read size.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">always return a string,the string can be empty is the connexion is
closed.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.send">
<code class="descclassname">AppletHTTP.</code><code class="descname">send</code><span class="sig-paren">(</span><em>applet</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Send the message <em>msg</em> on the http request body.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>msg</strong> (<em>string</em>) – the message to send.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.get_priv">
<code class="descclassname">AppletHTTP.</code><code class="descname">get_priv</code><span class="sig-paren">(</span><em>applet</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.get_priv" title="Permalink to this definition">¶</a></dt>
<dd><p>Return Lua data stored in the current transaction. If no data are stored,
it returns a nil value.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the opaque data previously stored, or nil if nothing is
available.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletHTTP.set_priv" title="AppletHTTP.set_priv"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.set_priv()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.set_priv">
<code class="descclassname">AppletHTTP.</code><code class="descname">set_priv</code><span class="sig-paren">(</span><em>applet</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.set_priv" title="Permalink to this definition">¶</a></dt>
<dd><p>Store any data in the current HAProxy transaction. This action replace the
old stored data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>data</strong> (<em>opaque</em>) – The data which is stored in the transaction.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletHTTP.get_priv" title="AppletHTTP.get_priv"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.get_priv()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.set_var">
<code class="descclassname">AppletHTTP.</code><code class="descname">set_var</code><span class="sig-paren">(</span><em>applet</em>, <em>var</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.set_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a Lua type in a HAProxy type and store it in a variable &lt;var&gt;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
<li><strong>value</strong> (<em>type</em>) – The value associated to the variable. The type ca be string or
integer.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#AppletHTTP.unset_var" title="AppletHTTP.unset_var"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.unset_var()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletHTTP.get_var" title="AppletHTTP.get_var"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.get_var()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.unset_var">
<code class="descclassname">AppletHTTP.</code><code class="descname">unset_var</code><span class="sig-paren">(</span><em>applet</em>, <em>var</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.unset_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Unset the variable &lt;var&gt;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#AppletHTTP.set_var" title="AppletHTTP.set_var"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.set_var()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletHTTP.get_var" title="AppletHTTP.get_var"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.get_var()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletHTTP.get_var">
<code class="descclassname">AppletHTTP.</code><code class="descname">get_var</code><span class="sig-paren">(</span><em>applet</em>, <em>var</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletHTTP.get_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns data stored in the variable &lt;var&gt; converter in Lua type.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletHTTP</em>) – An <a class="reference internal" href="#applethttp-class"><span class="std std-ref">AppletHTTP class</span></a></li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#AppletHTTP.set_var" title="AppletHTTP.set_var"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.set_var()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletHTTP.unset_var" title="AppletHTTP.unset_var"><code class="xref js js-func docutils literal"><span class="pre">AppletHTTP.unset_var()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="applettcp-class">
<span id="id16"></span><h1>AppletTCP class<a class="headerlink" href="#applettcp-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="AppletTCP">
<em class="property">class </em><code class="descname">AppletTCP</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is used with applets that requires the ‘tcp’ mode. The tcp applet
can be registered with the <em>core.register_service()</em> function. They are used
for processing a tcp stream like a server in back of HAProxy.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletTCP.c">
<code class="descclassname">AppletTCP.</code><code class="descname">c</code><a class="headerlink" href="#AppletTCP.c" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#converters-class"><span class="std std-ref">Converters class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Converters class object.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletTCP.sc">
<code class="descclassname">AppletTCP.</code><code class="descname">sc</code><a class="headerlink" href="#AppletTCP.sc" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#converters-class"><span class="std std-ref">Converters class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Converters class object. The
functions of this object returns always a string.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletTCP.f">
<code class="descclassname">AppletTCP.</code><code class="descname">f</code><a class="headerlink" href="#AppletTCP.f" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#fetches-class"><span class="std std-ref">Fetches class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Fetches class object.</p>
</dd></dl>

<dl class="attribute">
<dt id="AppletTCP.sf">
<code class="descclassname">AppletTCP.</code><code class="descname">sf</code><a class="headerlink" href="#AppletTCP.sf" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A <a class="reference internal" href="#fetches-class"><span class="std std-ref">Fetches class</span></a></td>
</tr>
</tbody>
</table>
<p>This attribute contains a Fetches class object.</p>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.getline">
<code class="descclassname">AppletTCP.</code><code class="descname">getline</code><span class="sig-paren">(</span><em>applet</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.getline" title="Permalink to this definition">¶</a></dt>
<dd><p>This function returns a string containing one line from the stream. If the
data returned doesn’t contains a final ‘\n’ its assumed than its the last
available data before the end of stream.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a string. The string can be empty if we reach the end of the stream.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.receive">
<code class="descclassname">AppletTCP.</code><code class="descname">receive</code><span class="sig-paren">(</span><em>applet</em><span class="optional">[</span>, <em>size</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.receive" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads data from the TCP stream, according to the specified read <em>size</em>. If the
<em>size</em> is missing, the function tries to read all the content of the stream
until the end.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
<li><strong>size</strong> (<em>integer</em>) – the required read size.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">always return a string,the string can be empty is the connexion is
closed.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.send">
<code class="descclassname">AppletTCP.</code><code class="descname">send</code><span class="sig-paren">(</span><em>appletmsg</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.send" title="Permalink to this definition">¶</a></dt>
<dd><p>Send the message on the stream.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
<li><strong>msg</strong> (<em>string</em>) – the message to send.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.get_priv">
<code class="descclassname">AppletTCP.</code><code class="descname">get_priv</code><span class="sig-paren">(</span><em>applet</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.get_priv" title="Permalink to this definition">¶</a></dt>
<dd><p>Return Lua data stored in the current transaction. If no data are stored,
it returns a nil value.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the opaque data previously stored, or nil if nothing is
available.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletTCP.set_priv" title="AppletTCP.set_priv"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.set_priv()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.set_priv">
<code class="descclassname">AppletTCP.</code><code class="descname">set_priv</code><span class="sig-paren">(</span><em>applet</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.set_priv" title="Permalink to this definition">¶</a></dt>
<dd><p>Store any data in the current HAProxy transaction. This action replace the
old stored data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
<li><strong>data</strong> (<em>opaque</em>) – The data which is stored in the transaction.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletTCP.get_priv" title="AppletTCP.get_priv"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.get_priv()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.set_var">
<code class="descclassname">AppletTCP.</code><code class="descname">set_var</code><span class="sig-paren">(</span><em>applet</em>, <em>var</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.set_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a Lua type in a HAProxy type and stores it in a variable &lt;var&gt;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
<li><strong>value</strong> (<em>type</em>) – The value associated to the variable. The type can be string or
integer.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#AppletTCP.unset_var" title="AppletTCP.unset_var"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.unset_var()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletTCP.get_var" title="AppletTCP.get_var"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.get_var()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.unset_var">
<code class="descclassname">AppletTCP.</code><code class="descname">unset_var</code><span class="sig-paren">(</span><em>applet</em>, <em>var</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.unset_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Unsets the variable &lt;var&gt;.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#AppletTCP.unset_var" title="AppletTCP.unset_var"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.unset_var()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletTCP.set_var" title="AppletTCP.set_var"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.set_var()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="AppletTCP.get_var">
<code class="descclassname">AppletTCP.</code><code class="descname">get_var</code><span class="sig-paren">(</span><em>applet</em>, <em>var</em><span class="sig-paren">)</span><a class="headerlink" href="#AppletTCP.get_var" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns data stored in the variable &lt;var&gt; converter in Lua type.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>applet</strong> (<em>class_AppletTCP</em>) – An <a class="reference internal" href="#applettcp-class"><span class="std std-ref">AppletTCP class</span></a></li>
<li><strong>var</strong> (<em>string</em>) – The variable name according with the HAProxy variable syntax.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">See:</th><td class="field-body"><p class="first"><a class="reference internal" href="#AppletTCP.unset_var" title="AppletTCP.unset_var"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.unset_var()</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">See:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#AppletTCP.set_var" title="AppletTCP.set_var"><code class="xref js js-func docutils literal"><span class="pre">AppletTCP.set_var()</span></code></a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="sticktable-class">
<h1>StickTable class<a class="headerlink" href="#sticktable-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="StickTable">
<em class="property">class </em><code class="descname">StickTable</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#StickTable" title="Permalink to this definition">¶</a></dt>
<dd><p><strong>context</strong>: task, action, sample-fetch</p>
<p>This class can be used to access the HAProxy stick tables from Lua.</p>
</dd></dl>

<dl class="function">
<dt id="StickTable.info">
<code class="descclassname">StickTable.</code><code class="descname">info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#StickTable.info" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns stick table attributes as a Lua table. See HAProxy documentation for
“stick-table” for canonical info, or check out example bellow.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Lua table</td>
</tr>
</tbody>
</table>
<p>Assume our table has IPv4 key and gpc0 and conn_rate “columns”:</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="n">expire</span><span class="o">=&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">#</span> <span class="n">Value</span> <span class="kr">in</span> <span class="n">ms</span>
  <span class="n">size</span><span class="o">=&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="p">,</span>    <span class="o">#</span> <span class="n">Maximum</span> <span class="n">table</span> <span class="n">size</span>
  <span class="n">used</span><span class="o">=&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="p">,</span>    <span class="o">#</span> <span class="n">Actual</span> <span class="n">number</span> <span class="n">of</span> <span class="n">entries</span> <span class="kr">in</span> <span class="n">table</span>
  <span class="n">data</span><span class="o">=</span><span class="p">{</span>         <span class="o">#</span> <span class="n">Data</span> <span class="n">columns</span><span class="p">,</span> <span class="n">with</span> <span class="n">types</span> <span class="n">as</span> <span class="n">key</span><span class="p">,</span> <span class="ow">and</span> <span class="n">periods</span> <span class="n">as</span> <span class="n">values</span>
                   <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="kr">if</span> <span class="nb">type</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">rate</span> <span class="n">counter</span><span class="p">)</span>
    <span class="n">conn_rate</span><span class="o">=&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">gpc0</span><span class="o">=-</span><span class="mi">1</span>
  <span class="p">},</span>
  <span class="n">length</span><span class="o">=&lt;</span><span class="n">int</span><span class="o">&gt;</span><span class="p">,</span>  <span class="o">#</span> <span class="n">max</span> <span class="n">string</span> <span class="n">length</span> <span class="kr">for</span> <span class="n">string</span> <span class="n">table</span> <span class="n">keys</span><span class="p">,</span> <span class="n">key</span> <span class="n">length</span>
                 <span class="o">#</span> <span class="n">otherwise</span>
  <span class="n">nopurge</span><span class="o">=&lt;</span><span class="n">boolean</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">#</span> <span class="n">purge</span> <span class="n">oldest</span> <span class="n">entries</span> <span class="n">when</span> <span class="n">table</span> <span class="n">is</span> <span class="n">full</span>
  <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;ip&quot;</span>      <span class="o">#</span> <span class="n">can</span> <span class="n">be</span> <span class="s2">&quot;ip&quot;</span><span class="p">,</span> <span class="s2">&quot;ipv6&quot;</span><span class="p">,</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;binary&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="function">
<dt id="StickTable.lookup">
<code class="descclassname">StickTable.</code><code class="descname">lookup</code><span class="sig-paren">(</span><em>key</em><span class="sig-paren">)</span><a class="headerlink" href="#StickTable.lookup" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns stick table entry for given &lt;key&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> (<em>string</em>) – Stick table key (IP addresses and strings are supported)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Lua table</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="StickTable.dump">
<code class="descclassname">StickTable.</code><code class="descname">dump</code><span class="sig-paren">(</span><span class="optional">[</span><em>filter</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#StickTable.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all entries in stick table. An optional filter can be used
to extract entries with specific data values. Filter is a table with valid
comparison operators as keys followed by data type name and value pairs.
Check out the HAProxy docs for “show table” for more details. For the
reference, the supported operators are:</p>
<blockquote>
<div>“eq”, “ne”, “le”, “lt”, “ge”, “gt”</div></blockquote>
<p>For large tables, execution of this function can take a long time (for
HAProxy standards). That’s also true when filter is used, so take care and
measure the impact.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first simple">
<li><strong>filter</strong> (<em>table</em>) – Stick table filter</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Stick table entries (table)</p>
</td>
</tr>
</tbody>
</table>
<p>See below for example filter, which contains 4 entries (or comparisons).
(Maximum number of filter entries is 4, defined in the source code)</p>
</dd></dl>

<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="n">filter</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span><span class="s2">&quot;gpc0&quot;</span><span class="p">,</span> <span class="s2">&quot;gt&quot;</span><span class="p">,</span> <span class="mi">30</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;gpc1&quot;</span><span class="p">,</span> <span class="s2">&quot;gt&quot;</span><span class="p">,</span> <span class="mi">20</span><span class="p">}},</span> <span class="p">{</span><span class="s2">&quot;conn_rate&quot;</span><span class="p">,</span> <span class="s2">&quot;le&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="external-lua-libraries">
<h1>External Lua libraries<a class="headerlink" href="#external-lua-libraries" title="Permalink to this headline">¶</a></h1>
<p>A lot of useful lua libraries can be found here:</p>
<ul class="simple">
<li><a class="reference external" href="https://lua-toolbox.com/">https://lua-toolbox.com/</a></li>
</ul>
<p>Redis acces:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/nrk/redis-lua">https://github.com/nrk/redis-lua</a></li>
</ul>
<p>This is an example about the usage of the Redis library with HAProxy. Note that
each call of any function of this library can throw an error if the socket
connection fails.</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="c1">-- load the redis library</span>
<span class="kd">local</span> <span class="n">redis</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;redis&quot;</span><span class="p">);</span>

<span class="kr">function</span> <span class="nf">do_something</span><span class="p">(</span><span class="n">txn</span><span class="p">)</span>

   <span class="c1">-- create and connect new tcp socket</span>
   <span class="kd">local</span> <span class="n">tcp</span> <span class="o">=</span> <span class="n">core</span><span class="p">.</span><span class="n">tcp</span><span class="p">();</span>
   <span class="n">tcp</span><span class="p">:</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
   <span class="n">tcp</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="mi">6379</span><span class="p">);</span>

   <span class="c1">-- use the redis library with this new socket</span>
   <span class="kd">local</span> <span class="n">client</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">connect</span><span class="p">({</span><span class="n">socket</span><span class="o">=</span><span class="n">tcp</span><span class="p">});</span>
   <span class="n">client</span><span class="p">:</span><span class="n">ping</span><span class="p">();</span>

<span class="kr">end</span>
</pre></div>
</div>
<p>OpenSSL:</p>
<ul class="simple">
<li><a class="reference external" href="http://mkottman.github.io/luacrypto/index.html">http://mkottman.github.io/luacrypto/index.html</a></li>
<li><a class="reference external" href="https://github.com/brunoos/luasec/wiki">https://github.com/brunoos/luasec/wiki</a></li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">How Lua runs in HAProxy</a><ul>
<li><a class="reference internal" href="#haproxy-lua-running-contexts">HAProxy Lua running contexts</a></li>
<li><a class="reference internal" href="#haproxy-lua-hello-world">HAProxy Lua Hello world</a></li>
</ul>
</li>
<li><a class="reference internal" href="#core-class">Core class</a></li>
<li><a class="reference internal" href="#proxy-class">Proxy class</a></li>
<li><a class="reference internal" href="#server-class">Server class</a></li>
<li><a class="reference internal" href="#listener-class">Listener class</a></li>
<li><a class="reference internal" href="#concat-class">Concat class</a></li>
<li><a class="reference internal" href="#fetches-class">Fetches class</a></li>
<li><a class="reference internal" href="#converters-class">Converters class</a></li>
<li><a class="reference internal" href="#channel-class">Channel class</a></li>
<li><a class="reference internal" href="#http-class">HTTP class</a></li>
<li><a class="reference internal" href="#txn-class">TXN class</a></li>
<li><a class="reference internal" href="#socket-class">Socket class</a></li>
<li><a class="reference internal" href="#regex-class">Regex class</a></li>
<li><a class="reference internal" href="#map-class">Map class</a></li>
<li><a class="reference internal" href="#applethttp-class">AppletHTTP class</a></li>
<li><a class="reference internal" href="#applettcp-class">AppletTCP class</a></li>
<li><a class="reference internal" href="#sticktable-class">StickTable class</a></li>
<li><a class="reference internal" href="#external-lua-libraries">External Lua libraries</a></li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="#">haproxy-lua 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Thierry FOURNIER.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.7.
    </div>
  </body>
</html>